<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favcion-apple.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/highlight/atom-one-dark.min.css">

<link rel="stylesheet" href="https://fonts.geekzu.org/css?family=EB+Garamond:300,300italic,400,400italic,700,700italic%7CCinzel+Decorative:300,300italic,400,400italic,700,700italic%7CNoto+Serif+SC:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"richardmyu.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":240,"offset":12,"width":320},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":null,"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="https://richardmyu.github.io/posts/8d968792/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://richardmyu.github.io/posts/8d968792/","path":"posts/8d968792/","title":"Hexo + Next - 相册功能"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo + Next - 相册功能 | Serendipity</title>
  







<link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Serendipity</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">悟已往之不谏，知来者之可追</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yum"
      src="https://raw.githubusercontent.com/richardmyu/gallery/1.0.0/avat/avatar_min.jpg">
  <p class="site-author-name" itemprop="name">yum</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/richardmyu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;richardmyu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/9646027/yum-3fe" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9646027&#x2F;yum-3fe" rel="noopener me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://richardmyu.github.io/posts/8d968792/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/richardmyu/gallery/1.0.0/avat/avatar_min.jpg">
      <meta itemprop="name" content="yum">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serendipity">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hexo + Next - 相册功能 | Serendipity">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hexo + Next - 相册功能
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-05 17:03:22" itemprop="dateCreated datePublished" datetime="2021-03-05T17:03:22+08:00">2021-03-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-18 21:47:22" itemprop="dateModified" datetime="2025-06-18T21:47:22+08:00">2025-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>添加相册功能内容比较多，单独成章。</p>
<span id="more"></span>
<p>前一段时间，整理手机的时候，发现手机内的照片太多了，而那个时候也在写一些书摘，就想着，要不在博客上建立一个相册吧？在搭建和配置这个博客（Hexo
&amp;
Next）的时候，已经知道不支持相册功能，但实在是很想弄一个，于是上网搜搜看，看也没有可以借鉴的。</p>
<p>在看来了多个文章之后，选择了其中几篇比较详尽，功能比较符合需求的文章为借鉴，根据自己的实际情况，以及自己的需求，做出一些修改和调整，并在此记录下来。</p>
<hr />
<p>1.<a target="_blank" rel="noopener" href="https://houmin.cc/posts/d487dd02/">Hexo NexT
添加多级相册功能</a><br> 2.<a
target="_blank" rel="noopener" href="https://malizhi.cn/HexoAlbum/">搭建Hexo博客相册</a><br> 3.<a
target="_blank" rel="noopener" href="https://www.zywvvd.com/2020/04/22/next/23_get_image_info/get-image-info/">Next
-23- 添加相册系列 -3- 获取图像信息、保存为json文件并上传图像</a></p>
<h3 id="增加相册-tab">1.增加相册 tab</h3>
<p>控制台执行 <code>hexo new page "album"</code>，然后会在
<code>source</code> 文件看到 <code>album</code> 以及
<code>index.md</code> 文件。</p>
<p>然后在主题下的配置文件（<code>themes/next/_config.yml</code>）增加
tab:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  ...</span><br><span class="line">  # 新增</span><br><span class="line">  album: /album/ || fa fa-camera</span><br></pre></td></tr></table></figure>
<p>图标可以自己更换，如果有语言切换，记得去主题的 <code>languages</code>
文件增加相册的对应语言词汇。</p>
<h3 id="一级相册">2.一级相册</h3>
<blockquote>
<p>单纯只要一级相册是挺简单的。但这里的一级相册，是要为二级相册做准备的。</p>
</blockquote>
<p>这里，我们使用模板来生成 album 页面，具体是在
<code>themes/next/layout</code> 下新建 <code>album.swig</code>
文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125;</span><br><span class="line">&#123;% import &#x27;_macro/sidebar.swig&#x27; as sidebar_template with context %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 添加相册 title #&#125;</span><br><span class="line">&#123;% block title %&#125;&#123;&#123; page.title &#125;&#125; | &#123;&#123; title &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;div class=&quot;posts-expand&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;post-block&quot; lang=&quot;&#123;&#123; page.lang or page.language or config.language &#125;&#125;&quot;&gt;</span><br><span class="line">            &#123;# 不想在相册页面显示 “相册”，则注释下一条代码 #&#125;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/page-header.swig&#x27; %&#125; #&#125;</span><br><span class="line">            &lt;div class=&quot;post-body&#123;%- if page.direction and page.direction.toLowerCase() === &#x27;rtl&#x27; %&#125; rtl&#123;%- endif %&#125;&quot;&gt;</span><br><span class="line">                &#123;% if config.album %&#125;</span><br><span class="line">                &lt;div class=&quot;album-wrapper row&quot;&gt;</span><br><span class="line">                    &#123;% for gallery in config.album.gallery %&#125;</span><br><span class="line">                    &lt;div class=&quot;album-box&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;./&#123;&#123; gallery.name &#125;&#125;&quot; class=&quot;album-item&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;album-cover-box&quot; style=&quot;background-image: url(&#123;&#123; config.album.image_bed &#125;&#125;/&#123;&#123; gallery.name &#125;&#125;/thumbnail/&#123;&#123; gallery.cover &#125;&#125;);&quot;&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;p class=&quot;album-name&quot;&gt;</span><br><span class="line">                                &#123;&#123; gallery.name &#125;&#125;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;p class=&quot;album-description&quot;&gt;</span><br><span class="line">                            &#123;&#123; gallery.description &#125;&#125;</span><br><span class="line">                        &lt;p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block sidebar %&#125;</span><br><span class="line">  &#123;&#123; sidebar_template.render(true) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>细节上，可以根据自己的实际需求进行修改调整。然后要在<strong>站点</strong>配置文件(<code>_config.yml</code>)中，添加相册的信息：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">album:</span></span><br><span class="line">  <span class="attr">imageBed:</span> <span class="string">https://xxx.xx.com/album</span></span><br><span class="line">  <span class="attr">gallery:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>对于相册而已，这里只是生成了 html 页面，如有需要你可以根据 css
来定制对应的样式。这里 css
数据放在了<code>souce/_data/styles.styl</code> 中。</p>
<p>最后修改 <code>source/album/index.md</code> 文件：</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">date: xxxx-xx-xx xx:xx:xx</span><br><span class="line">layout: album</span><br><span class="line"><span class="section">title: &#x27;相册&#x27;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
<p><code>layout: album</code> 用来指定使用 <code>album.swig</code>
来渲染出相册的 HTML 页面。</p>
<h3 id="二级相册">3.二级相册</h3>
<p>在 <code>source/album</code> 下，创建 gallery
目录，具体是指，根据站点配置信息，建立对应的图册目录。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">album:</span></span><br><span class="line">  <span class="attr">imageBed:</span> <span class="string">https://xxx.xx.com/album</span></span><br><span class="line">  <span class="attr">gallery:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;flowers&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;sky&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>对应 gallery :</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">|-- album</span><br><span class="line">|    |</span><br><span class="line">|    |-- index.md</span><br><span class="line">|    |</span><br><span class="line">|    |-- flowers</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- data.json</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- index.md</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- sky</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- data.json</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- index.md</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- ...</span><br><span class="line">|</span><br></pre></td></tr></table></figure>
<p>下面是描述相册的 JSON 文件，可以通过 Python
脚本自动生成和更新（后面有讲述）。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flowers&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx...xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxx-xx-xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;imageBed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://xxx.xxcom/album&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;caption&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx....xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxx-xx-xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx,xxx,xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">6400</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">4000</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>下面是 gallery 的 <code>index.md</code> 文件：</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">date: xxxx-xx-xx xx:xx:xx</span><br><span class="line">fancybox: false</span><br><span class="line">layout: gallery</span><br><span class="line">title: &#x27;flowers&#x27;</span><br><span class="line"><span class="section">galleryName: &#x27;flowers&#x27;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
<p>接下来，就要编写 gallery 的模板了。跟一级相册一样，还是在在
<code>themes/next/layout</code> 下新建 <code>gallery.swig</code>
文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125;</span><br><span class="line">&#123;% import &#x27;_macro/sidebar.swig&#x27; as sidebar_template with context %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;&#123;&#123; page.title &#125;&#125; | &#123;&#123; title &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;posts-expand&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;post-block&quot; lang=&quot;&#123;&#123; page.lang or page.language or config.language &#125;&#125;&quot;&gt;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/page-header.swig&#x27; %&#125; #&#125;</span><br><span class="line">            &lt;div class=&quot;post-body&#123;%- if page.direction and page.direction.toLowerCase() === &#x27;rtl&#x27; %&#125; rtl&#123;%- endif %&#125;&quot;&gt;</span><br><span class="line">                &lt;link rel=&quot;stylesheet&quot; href=&quot;/lib/album/photoswipe.css&quot;&gt;</span><br><span class="line">                &lt;link rel=&quot;stylesheet&quot; href=&quot;/lib/album/default-skin/default-skin.css&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# gallery body #&#125;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;gallery&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;gallery-description&quot;&gt;</span><br><span class="line">                        &lt;p id=&quot;gallery-description&quot;&gt;这里是相册描述&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div class=&quot;instagram itemscope&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;https://richyu.gitee.io/&quot; target=&quot;_blank&quot; class=&quot;open-ins&quot;&gt;图片正在加载中…&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &#123;# gallery body end #&#125;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- Core JS file --&gt; #&#125;</span><br><span class="line">                &lt;script src=&quot;/lib/album/photoswipe.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- UI JS file --&gt; #&#125;</span><br><span class="line">                &lt;script src=&quot;/lib/album/photoswipe-ui-default.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- gallery.js --&gt; #&#125;</span><br><span class="line">                &lt;script&gt;</span><br><span class="line">                    (function() &#123;</span><br><span class="line">                        var loadScript = function(path) &#123;</span><br><span class="line">                        var $script = document.createElement(&#x27;script&#x27;)</span><br><span class="line">                        document.getElementsByTagName(&#x27;body&#x27;)[0].appendChild($script)</span><br><span class="line">                        $script.setAttribute(&#x27;src&#x27;, path)</span><br><span class="line">                        &#125;</span><br><span class="line">                        setTimeout(function() &#123;</span><br><span class="line">                            loadScript(&#x27;/lib/album/gallery.min.js&#x27;)</span><br><span class="line">                        &#125;, 0)</span><br><span class="line">                    &#125;)()</span><br><span class="line">                &lt;/script&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/breadcrumb.swig&#x27; %&#125; #&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;# &lt;!-- Root element of PhotoSwipe. Must have class pswp. --&gt; #&#125;</span><br><span class="line">    &lt;div class=&quot;pswp&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-hidden=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;# &lt;!-- Background of PhotoSwipe.</span><br><span class="line">         It&#x27;s a separate element, as animating opacity is faster than rgba(). --&gt; #&#125;</span><br><span class="line">        &lt;div class=&quot;pswp__bg&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &#123;# &lt;!-- Slides wrapper with overflow:hidden. --&gt; #&#125;</span><br><span class="line">        &lt;div class=&quot;pswp__scroll-wrap&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &#123;# &lt;!-- Container that holds slides. PhotoSwipe keeps only 3 slides in DOM to save memory. --&gt; #&#125;</span><br><span class="line">            &#123;# &lt;!-- don&#x27;t modify these 3 pswp__item elements, data is added later on. --&gt; #&#125;</span><br><span class="line">            &lt;div class=&quot;pswp__container&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &#123;# &lt;!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --&gt; #&#125;</span><br><span class="line">            &lt;div class=&quot;pswp__ui pswp__ui--hidden&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__top-bar&quot;&gt;</span><br><span class="line"></span><br><span class="line">                    &#123;# &lt;!--  Controls are self-explanatory. Order can be changed. --&gt; #&#125;</span><br><span class="line">                    &lt;div class=&quot;pswp__counter&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--close&quot; title=&quot;Close (Esc)&quot;&gt;&lt;/button&gt;</span><br><span class="line">                    &#123;# &lt;button class=&quot;pswp__button pswp__button--share&quot; title=&quot;Share&quot;&gt;&lt;/button&gt; #&#125;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--fs&quot; title=&quot;Toggle fullscreen&quot;&gt;&lt;/button&gt;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--zoom&quot; title=&quot;Zoom in/out&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                    &#123;# &lt;!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --&gt; #&#125;</span><br><span class="line">                    &#123;# &lt;!-- element will get class pswp__preloader--active when preloader is running --&gt; #&#125;</span><br><span class="line">                    &lt;div class=&quot;pswp__preloader&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;pswp__preloader__icn&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;pswp__preloader__cut&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;pswp__preloader__donut&quot;&gt;&lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__share-modal pswp__share-modal--hidden pswp__single-tap&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;pswp__share-tooltip&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;button class=&quot;pswp__button pswp__button--arrow--left&quot; title=&quot;Previous (arrow left)&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                &lt;button class=&quot;pswp__button pswp__button--arrow--right&quot; title=&quot;Next (arrow right)&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__caption&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;pswp__caption__center&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block sidebar %&#125;</span><br><span class="line">  &#123;&#123; sidebar_template.render(true) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>到此为止，页面基本完成，剩下的就是编写 <code>gallery.js</code>
了。</p>
<h3 id="编写脚本">4.编写脚本</h3>
<p>在 <code>themes/next/source/lib</code> 下，新建 album
目录，创建一下文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|</span><br><span class="line">|-- album</span><br><span class="line">|    |</span><br><span class="line">|    |-- assets</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- empty,png</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- default-skin</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.css</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.png</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.svg</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- preloader.gif</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- gallery.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- handler_photoswipe.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe-ui-default.min.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe.css</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe.min.js</span><br><span class="line">|    |</span><br><span class="line">|</span><br></pre></td></tr></table></figure>
<p>以上这些图片以及脚本均可以在 <a
target="_blank" rel="noopener" href="https://github.com/richardmyu/richardmyu.github.io/tree/main/lib/album">/tree/main/lib/album</a>中找到。</p>
<p>其中一个重点在 <code>gallery.js</code> 文件中。</p>
<p>这是参考文章中的脚本：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;lazyloadjs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> photoswipe = <span class="built_in">require</span>(<span class="string">&quot;./handler_photoswipe.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> view = <span class="title function_">_interopRequireDefault</span>(photoswipe.<span class="property">viewer</span>);</span><br><span class="line"><span class="keyword">var</span> galleryPath = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line"><span class="keyword">var</span> galleryName = galleryPath.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> dataUrl = <span class="string">&#x27;/album/&#x27;</span> + galleryName + <span class="string">&#x27;/data.json&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> dataJSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_interopRequireDefault</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.<span class="property">__esModule</span> ? obj : &#123;</span><br><span class="line">    <span class="attr">default</span>: obj</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> render = <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">response</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> imageBed = response[<span class="string">&quot;image_bed&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> description = response[<span class="string">&quot;description&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> items = response[<span class="string">&quot;items&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> ulTmpl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">    <span class="keyword">var</span> liTmpl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> date = item[<span class="string">&#x27;date&#x27;</span>]</span><br><span class="line">    <span class="keyword">var</span> year = date.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> month = date.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> img <span class="keyword">of</span> item[<span class="string">&quot;images&quot;</span>]) &#123;</span><br><span class="line">      <span class="keyword">var</span> thumbnail = imageBed + <span class="string">&#x27;/&#x27;</span> + galleryName + <span class="string">&quot;/thumbnail/&quot;</span> + img.<span class="property">name</span>;</span><br><span class="line">      <span class="keyword">var</span> artwork = imageBed + <span class="string">&#x27;/&#x27;</span> + galleryName + <span class="string">&quot;/artwork/&quot;</span> + img.<span class="property">name</span>;</span><br><span class="line">      <span class="keyword">var</span> caption = img.<span class="property">caption</span>;</span><br><span class="line">      <span class="keyword">var</span> address = img.<span class="property">address</span></span><br><span class="line">      <span class="keyword">var</span> width = img.<span class="property">width</span>;</span><br><span class="line">      <span class="keyword">var</span> height = img.<span class="property">height</span>;</span><br><span class="line"></span><br><span class="line">      liTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;figure class=&quot;thumb&quot; itemprop=&quot;associatedMedia&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;<span class="subst">$&#123;artwork&#125;</span>&quot; itemprop=&quot;contentUrl&quot; data-size=&quot;<span class="subst">$&#123;width&#125;</span>x<span class="subst">$&#123;height&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;img class=&quot;reward-img&quot; data-src=&quot;<span class="subst">$&#123;thumbnail&#125;</span>&quot; src=&quot;/lib/album/assets/empty.png&quot; itemprop=&quot;thumbnail&quot; onload=&quot;lzld(this)&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;figcaption style=&quot;display:none;&quot; itemprop=&quot;caption description&quot;&gt;<span class="subst">$&#123;address || caption&#125;</span>&lt;/figcaption&gt;</span></span><br><span class="line"><span class="string">      &lt;/figure&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ulTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;section class=&quot;archives album&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 class=&quot;timeline&quot;&gt;<span class="subst">$&#123;year&#125;</span> 年 <span class="subst">$&#123;month&#125;</span> 月&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;img-box&quot;&gt;<span class="subst">$&#123;liTmpl&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/section&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.instagram&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">`&lt;div class=<span class="subst">$&#123;photoswipe.galleryClass&#125;</span> itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageGallery&quot;&gt;<span class="subst">$&#123;ulTmpl&#125;</span>&lt;/div&gt;`</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#gallery-description&#x27;</span>).<span class="property">innerHTML</span> = description;</span><br><span class="line"></span><br><span class="line">  view.<span class="property">default</span>.<span class="title function_">init</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadData</span>(<span class="params">render</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!dataJSON) &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, dataUrl, <span class="literal">true</span>);</span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        dataJSON = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span><br><span class="line">        <span class="title function_">render</span>(dataJSON);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">statusText</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">statusText</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(dataJSON);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Gallery</span> = &#123;</span><br><span class="line">  <span class="attr">init</span>: <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">loadData</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="title function_">render</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Gallery</span>.<span class="title function_">init</span>();</span><br></pre></td></tr></table></figure>
<p>需要注意的一点是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ulTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;section class=&quot;archives album&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 class=&quot;timeline&quot;&gt;<span class="subst">$&#123;year&#125;</span> 年 <span class="subst">$&#123;month&#125;</span> 月&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;img-box&quot;&gt;<span class="subst">$&#123;liTmpl&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/section&gt;`</span>;</span><br></pre></td></tr></table></figure>
<p>从 <code>&lt;section class="archives album"&gt;</code> 到
<code>$&#123;liTmpl&#125;</code>，中间只能嵌套一层；若想要嵌套多层，要修改
<code>handler_photoswipe.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parseThumbnailElements = <span class="keyword">function</span> <span class="title function_">parseThumbnailElements</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// 两次获取父节点，限定了最多只能嵌套一层，</span></span><br><span class="line">    <span class="comment">// 超过一层（多层情况也一致），会因为祖父节点定位在单个照片组之内，</span></span><br><span class="line">    <span class="comment">// 使得 photoswipe 将照片组甚至单个照片视为一个相册，</span></span><br><span class="line">    <span class="comment">// 从而造成点击的照片在“相册”中的索引与当前与全局获取图片的索引不一致</span></span><br><span class="line">    <span class="comment">// 结果就是点击图片，放大的是另一张图片</span></span><br><span class="line">    el = el.<span class="property">parentNode</span>.<span class="property">parentNode</span>;</span><br><span class="line">    <span class="keyword">var</span> thumbElements = el.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;thumb&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// 获取该页面全部图片 `thumb` </span></span><br><span class="line">childNodes = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;thumb&#x27;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>放大图片的规则：当前点击照片全局索引 a，当前“相册” 照片数
x，放大的图片在该“相册”内的索引是 a；自然会有 a &gt; x
的情况，那结果就是取“相册”的第一张照片。</p>
</blockquote>
<h3 id="自动化-json">5.自动化 JSON</h3>
<p>上面说到相册的数据是从 <code>data.json</code>
读取的，如果照片或者相册比较多，那么写 JSON 会很无聊的，所以我们使用
Python 来完成这个工作。</p>
<blockquote>
<p>因为我使用了 Gitee 的仓库来作为图床，所以便也把 python
脚本也写在了图床仓库里。</p>
</blockquote>
<p>这一部分参考 <a target="_blank" rel="noopener" href="https://houmin.cc/posts/d487dd02/">Hexo NexT
添加多级相册功能</a>
就可以了，实际也可以根据自己的需求，进行部分修改和调整，比如我就增加了批量添加图片，解析
GPS
获取地址以及拍摄日期（个人觉得从图片名称获取日期不确定性比较大，甚至可能得修改图片名称）。</p>
<blockquote>
<p>为了获取 Exif
信息，肯定得放上原图，但原图如果上传到图库，也不合适（:smirk:那你还不是主动提供了地址。。。:joy::joy::joy:
），所以我多增加了一个文件，用来存放原图，且不上传的。</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_orientation</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    处理图片的自动（PIL处理回发生）旋转</span></span><br><span class="line"><span class="string">    增加对 width / height 的调换处理</span></span><br><span class="line"><span class="string">    https://cloud.tencent.com/developer/article/1523050</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    exif_orientation_tag = <span class="number">274</span></span><br><span class="line">    w, h = img.size</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(img, <span class="string">&quot;_getexif&quot;</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(img._getexif(), <span class="built_in">dict</span>) <span class="keyword">and</span> exif_orientation_tag <span class="keyword">in</span> img._getexif():</span><br><span class="line">        exif_data = img._getexif()</span><br><span class="line">        orientation = exif_data[exif_orientation_tag]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Handle EXIF Orientation</span></span><br><span class="line">        <span class="keyword">if</span> orientation == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># Normal image - nothing to do!</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># Mirrored left to right</span></span><br><span class="line">            <span class="comment"># transpose 翻转</span></span><br><span class="line">            img = img.transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># Rotated 180 degrees</span></span><br><span class="line">            img = img.rotate(<span class="number">180</span>)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">4</span>:</span><br><span class="line">            <span class="comment"># Mirrored top to bottom</span></span><br><span class="line">            img = img.rotate(<span class="number">180</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">5</span>:</span><br><span class="line">            <span class="comment"># Mirrored along top-left diagonal</span></span><br><span class="line">            img = img.rotate(-<span class="number">90</span>, expand=<span class="literal">True</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">6</span>:</span><br><span class="line">            <span class="comment"># Rotated 90 degrees</span></span><br><span class="line">            img = img.rotate(-<span class="number">90</span>, expand=<span class="literal">True</span>)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">7</span>:</span><br><span class="line">            <span class="comment"># Mirrored along top-right diagonal</span></span><br><span class="line">            img = img.rotate(<span class="number">90</span>, expand=<span class="literal">True</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">8</span>:</span><br><span class="line">            <span class="comment"># Rotated 270 degrees</span></span><br><span class="line">            img = img.rotate(<span class="number">90</span>, expand=<span class="literal">True</span>)</span><br><span class="line">            w, h = h, w</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: img,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: (w, h)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_geocoder</span>(<span class="params">geolocator, lat_lon, sleep_sec=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据经纬度，计算区域</span></span><br><span class="line"><span class="string">    https://www.pythonheidong.com/blog/article/680556/d9bf76d691415de282f1/</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 反向地理编码</span></span><br><span class="line">        <span class="keyword">return</span> geolocator.reverse(lat_lon)</span><br><span class="line">    <span class="keyword">except</span> GeocoderTimedOut:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout: GeocoderTimedOut Retrying...&#x27;</span>)</span><br><span class="line">        time.sleep(randint(<span class="number">2</span> * <span class="number">100</span>, sleep_sec * <span class="number">100</span>) / <span class="number">50</span>)</span><br><span class="line">        <span class="keyword">return</span> AlbumTool.reverse_geocoder(geolocator, lat_lon, sleep_sec)</span><br><span class="line">    <span class="keyword">except</span> GeocoderServiceError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;CONNECTION REFUSED: GeocoderServiceError encountered.&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ERROR: Terminating due to exception &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_exif</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    获取图片的经纬度以及拍摄时间等信息</span></span><br><span class="line"><span class="string">    https://zhuanlan.zhihu.com/p/98460548</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Loading and Resolving: &quot;</span> + img)</span><br><span class="line">    f = <span class="built_in">open</span>(img, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    image_map = exifread.process_file(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 图片的经度</span></span><br><span class="line">        img_longitude_ref = image_map[<span class="string">&quot;GPS GPSLongitudeRef&quot;</span>].printable</span><br><span class="line">        img_longitude = image_map[<span class="string">&quot;GPS GPSLongitude&quot;</span>].printable[<span class="number">1</span>:-<span class="number">1</span>].replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;,&quot;</span>).split(</span><br><span class="line">            <span class="string">&quot;,&quot;</span>)</span><br><span class="line">        img_longitude = <span class="built_in">float</span>(img_longitude[<span class="number">0</span>]) + <span class="built_in">float</span>(img_longitude[<span class="number">1</span>]) / <span class="number">60</span> + <span class="built_in">float</span>(</span><br><span class="line">            img_longitude[<span class="number">2</span>]) / <span class="built_in">float</span>(img_longitude[<span class="number">3</span>]) / <span class="number">3600</span></span><br><span class="line">        <span class="keyword">if</span> img_longitude_ref != <span class="string">&quot;E&quot;</span>:</span><br><span class="line">            img_longitude = img_longitude * (-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 图片的纬度</span></span><br><span class="line">        img_latitude_ref = image_map[<span class="string">&quot;GPS GPSLatitudeRef&quot;</span>].printable</span><br><span class="line">        img_latitude = image_map[<span class="string">&quot;GPS GPSLatitude&quot;</span>].printable[<span class="number">1</span>:-<span class="number">1</span>].replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;,&quot;</span>).split(</span><br><span class="line">            <span class="string">&quot;,&quot;</span>)</span><br><span class="line">        img_latitude = <span class="built_in">float</span>(img_latitude[<span class="number">0</span>]) + <span class="built_in">float</span>(img_latitude[<span class="number">1</span>]) / <span class="number">60</span> + <span class="built_in">float</span>(img_latitude[<span class="number">2</span>]) / <span class="built_in">float</span>(</span><br><span class="line">            img_latitude[<span class="number">3</span>]) / <span class="number">3600</span></span><br><span class="line">        <span class="keyword">if</span> img_latitude_ref != <span class="string">&quot;N&quot;</span>:</span><br><span class="line">            img_latitude = img_latitude * (-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ERROR: 图片中不包含 Gps 信息&#x27;</span>)</span><br><span class="line">        img_latitude = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        img_longitude = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 照片拍摄时间</span></span><br><span class="line">    img_create_date = image_map[<span class="string">&quot;Image DateTime&quot;</span>].printable[:<span class="number">10</span>].replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;-&quot;</span>)</span><br><span class="line"></span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    location = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> img_latitude != <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> img_longitude != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        reverse_value = <span class="built_in">str</span>(img_latitude) + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">str</span>(img_longitude)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化 Nominatim() 时传入新的 user-agent 值，避开样例值</span></span><br><span class="line">        user_agent = <span class="string">&#x27;my_blog_agent_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(randint(<span class="number">10000</span>, <span class="number">99999</span>))</span><br><span class="line">        geolocator = Nominatim(user_agent=user_agent)</span><br><span class="line">        location = AlbumTool.reverse_geocoder(geolocator, reverse_value)</span><br><span class="line"></span><br><span class="line">    address = location <span class="keyword">and</span> location.address <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    info = &#123;</span><br><span class="line">        <span class="string">&#x27;address&#x27;</span>: address,  <span class="comment"># 地址</span></span><br><span class="line">        <span class="string">&#x27;date&#x27;</span>: img_create_date  <span class="comment"># 日期</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> info</span><br></pre></td></tr></table></figure>
<p>批量添加很简单就不说了。目前为止，相册部分算是基本完工了。效果见 <a
target="_blank" rel="noopener" href="https://richyu.gitee.io/album/">album</a>。</p>
<h5 id="补充">补充</h5>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(self.data_json) <span class="keyword">as</span> json_file:</span><br><span class="line">    data = json.load(json_file)</span><br><span class="line">    items =  data[<span class="string">&quot;items&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>这行代码可能会二次读取 JSON
时，造成乱码，解决方法就是指定读取格式：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(self.data_json, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> json_file</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>yum
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://richardmyu.github.io/posts/8d968792/" title="Hexo + Next - 相册功能">https://richardmyu.github.io/posts/8d968792/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/hexo/" rel="tag"># hexo</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/a3ec7b81/" rel="prev" title="【书】一个孤独的散步者的梦">
                  <i class="fa fa-angle-left"></i> 【书】一个孤独的散步者的梦
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/48e8e238/" rel="next" title="【影】小森林">
                  【影】小森林 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2018 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">yum</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

<script src="/js/highlight.min.js"></script>
<script>
  $(function(){
    $('pre code').each((i, el) => {
    hljs.highlightElement(el);
  });
</script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
