<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favcion-apple.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="/css/highlight/atom-one-dark.min.css">

<link rel="stylesheet" href="https://fonts.geekzu.org/css?family=EB+Garamond:300,300italic,400,400italic,700,700italic%7CCinzel+Decorative:300,300italic,400,400italic,700,700italic%7CNoto+Serif+SC:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"richardmyu.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.19.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":240,"offset":12,"width":320},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":null,"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="https://richardmyu.github.io/posts/fb53055d/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://richardmyu.github.io/posts/fb53055d/","path":"posts/fb53055d/","title":"Hexo + Next - ä¸ªäººåšå®¢é…ç½®é—®é¢˜"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo + Next - ä¸ªäººåšå®¢é…ç½®é—®é¢˜ | Serendipity</title>
  







<link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Serendipity</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æ‚Ÿå·²å¾€ä¹‹ä¸è°ï¼ŒçŸ¥æ¥è€…ä¹‹å¯è¿½</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yum"
      src="https://raw.githubusercontent.com/richardmyu/gallery/1.0.0/avat/avatar_min.jpg">
  <p class="site-author-name" itemprop="name">yum</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/richardmyu" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;richardmyu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/9646027/yum-3fe" title="StackOverflow â†’ https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9646027&#x2F;yum-3fe" rel="noopener me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://richardmyu.github.io/posts/fb53055d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/richardmyu/gallery/1.0.0/avat/avatar_min.jpg">
      <meta itemprop="name" content="yum">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Serendipity">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Hexo + Next - ä¸ªäººåšå®¢é…ç½®é—®é¢˜ | Serendipity">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Hexo + Next - ä¸ªäººåšå®¢é…ç½®é—®é¢˜
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-01 21:33:09" itemprop="dateCreated datePublished" datetime="2021-01-01T21:33:09+08:00">2021-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-06-13 20:46:08" itemprop="dateModified" datetime="2025-06-13T20:46:08+08:00">2025-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>è®°å½• Hexo + Next æ­å»ºåšå®¢è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é…ç½®å’Œé—®é¢˜ã€‚</p>
<span id="more"></span>
<h2 id="1gulp-å®‰è£…æ›´æ–°"><a class="markdownIt-Anchor" href="#1gulp-å®‰è£…æ›´æ–°"></a> 1.<strong>gulp</strong> å®‰è£…æ›´æ–°</h2>
<p>æ‰§è¡Œ <code>hexo g</code> ä¹‹åç”Ÿæˆçš„ä»£ç ï¼Œç»“æ„æ¯”è¾ƒä¹±ï¼Œç©ºæ ¼ç©ºè¡Œéƒ½å¾ˆå¤šï¼Œä½¿ç”¨ <code>gulp</code> è¿›è¡Œå‹ç¼©ï¼Œä»¥è·å–æ›´å¿«çš„åŠ è½½é€Ÿåº¦ã€‚</p>
<p>æ—§ç‰ˆæœ¬ HEXO çš„å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install -g gulp</span><br></pre></td></tr></table></figure>
<p>æ–°ç‰ˆæœ¬ HEXOï¼ˆ5.xï¼‰ å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install gulp-cli -g</span><br><span class="line">npm install gulp -D</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¶Šæ¥è¶Šå¤šçš„äººè®¤åŒçš„ä¸€ä¸ªå…±è¯†æ˜¯ï¼šæœ€å¥½ä¸è¦å…¨å±€å®‰è£…é¡¹ç›®æ‰€éœ€è¦çš„ä¾èµ–ã€‚</p>
</blockquote>
<p>è¿™ä¸»è¦æ˜¯ç”±äºè¿™äº›ä¾èµ–ä¸ä¼šæ˜¾ç¤ºåœ¨é¡¹ç›®çš„ä¾èµ–é¡¹åˆ—è¡¨ä¸­ï¼Œå¦‚æœè¦å…±äº«ä»£ç ï¼Œåˆ™æ„å‘³ç€æ‚¨éœ€è¦æ˜ç¡®å£°æ˜æ‚¨çš„é¡¹ç›®å…·æœ‰çš„ä¾èµ–é¡¹è¶…å‡ºäº†ä¾èµ–æ–‡ä»¶æœ¬èº«ã€‚ä½¿é—®é¢˜æ›´åŠ å¤æ‚çš„æ˜¯ï¼Œæ‚¨å¯èƒ½å°†é¡¹ç›®æç½®ä¸€æ®µæ—¶é—´ï¼Œç„¶åå°†å…¨å±€è½¯ä»¶åŒ…å®‰è£…æ›´æ–°ä¸ºä¸é¡¹ç›®ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ä¸å…¼å®¹çš„æŸä¸ªæ–°ç‰ˆæœ¬ï¼Œä»è€Œåœ¨é‡æ–°è®¿é—®è¯¥é¡¹ç›®æ—¶å¼•èµ·å†²çªã€‚æ®æˆ‘äº†è§£ï¼Œ<code>gulp-cli</code></p>
<blockquote>
<p>ç›´æ¥è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨é€šè¿‡æä¾› shell è®¿é—®æ¥è¿è¡Œ gulp<br />
çš„æœ¬åœ°å®‰è£…ï¼Œå°±å¥½åƒå®ƒæ˜¯å…¨å±€å®‰è£…ä¸€æ ·ã€‚ <a target="_blank" rel="noopener" href="https://teamtreehouse.com/community/gulp-global-install-gulp-vs-gulpcli">Gulp global install - gulp vs gulp-cli</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35571679/what-does-gulp-cli-stands-for">what does gulp-â€œcliâ€ stands for?</a></p>
</blockquote>
<p><strong>è¯­æ³•é—®é¢˜</strong></p>
<p>æ³¨æ„ gulp è¯­æ³•ï¼ˆå¯¹äº 4.x ç‰ˆæœ¬è€Œè¨€ï¼‰å·²ç»æ›´æ–°çš„é—®é¢˜ï¼š</p>
<p>æ—§ç‰ˆæœ¬ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//JSå‹ç¼©</span></span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;uglify&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.<span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.js&#x27;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ–°ç‰ˆæœ¬ï¼ˆ4.0.2ï¼‰è¯­æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">miniJs</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">pipeline</span>(</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&#x27;./public/**/*.js&#x27;</span>),</span><br><span class="line">    <span class="title function_">uglify</span>(),</span><br><span class="line">    <span class="title function_">dest</span>(<span class="string">&#x27;./public&#x27;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½éšç€æ—¶é—´æ¨ç§»ï¼Œè¿™é‡Œè¯´çš„ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œæ€»ä¹‹è®°å¾—å»å®˜ç½‘çœ‹è¯­æ³•ã€‚</p>
<h2 id="2å›¾ç‰‡æ¨¡å—å®‰è£…æ›´æ–°"><a class="markdownIt-Anchor" href="#2å›¾ç‰‡æ¨¡å—å®‰è£…æ›´æ–°"></a> 2.å›¾ç‰‡æ¨¡å—å®‰è£…æ›´æ–°</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install gulp-htmlclean gulp-htmlmin gulp-minify-css gulp-uglify gulp-imagemin --save</span><br></pre></td></tr></table></figure>
<p>è¿™äº›éƒ½æ˜¯å¼€å‘ä¾èµ–ï¼Œåº”è¯¥æ”¾åˆ° <code>devDependencies</code> ä¸­å»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install gulp-htmlclean gulp-htmlmin gulp-minify-css gulp-imagemin --save-dev</span><br><span class="line"># or</span><br><span class="line">npm install gulp-htmlclean gulp-htmlmin gulp-minify-css gulp-imagemin -D</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œæˆ‘æŠŠå…¶ä¸­çš„ <code>gulp-uglify</code> æ‹¿å‡ºæ¥æ²¡æœ‰å®‰è£…ï¼Œæ˜¯å› ä¸ºå¦‚æœå‹ç¼©çš„ JavaScript ä»£ç æ¶‰åŠåˆ°æŸäº› ES6<br />
è¯­æ³•æ—¶ï¼Œä¼šå› è¯­æ³•é—®é¢˜è€Œæ— æ³•æˆåŠŸå‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨ <code>gulp-uglify-es</code> è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<blockquote>
<p><code>gulp-uglify</code> çš„é—®é¢˜å¯ä»¥è§ <a target="_blank" rel="noopener" href="https://github.com/richardmyu/Blog/issues/16">gulp å‹ç¼©ä¹‹ gulp-uglify #16</a></p>
</blockquote>
<h2 id="3gulp-imagemin-æ¨¡å—éƒ¨åˆ†è§„åˆ™æ›´æ–°"><a class="markdownIt-Anchor" href="#3gulp-imagemin-æ¨¡å—éƒ¨åˆ†è§„åˆ™æ›´æ–°"></a> 3.<code>gulp-imagemin</code> æ¨¡å—éƒ¨åˆ†è§„åˆ™æ›´æ–°</h2>
<p><code>jpegtran</code> æ²¡æœ‰äº†ï¼Œéœ€è¦ç”¨ <code>mozjpeg</code> ä»£æ›¿ã€‚</p>
<p>åŒæ ·ä¹Ÿæ˜¯å› ä¸ºç‰ˆæœ¬æ›´æ–°ï¼Œéƒ¨åˆ†å‚æ•°æˆ–æ–¹æ³•ä»¥å‘ç”Ÿå˜åŒ–ï¼Œæ€»ä¹‹ï¼Œè‹¥æœ‰é—®é¢˜ï¼Œå…ˆå‚è€ƒå®˜ç½‘ã€‚<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/gulp-imagemin">æ›´å¤šç»†èŠ‚</a></p>
<h2 id="4å›¾ç‰‡"><a class="markdownIt-Anchor" href="#4å›¾ç‰‡"></a> 4.å›¾ç‰‡</h2>
<p>1.ä½¿ç”¨ PS å‹ç¼©å›¾ç‰‡ï¼›<br />
2.ä½¿ç”¨å›¾åºŠæˆ– CDN æ¥åŠ è½½å›¾ç‰‡ï¼Œè€Œä¸æ˜¯æ”¾åœ¨åšå®¢è‡ªèº«ç›®å½•ä¸‹ï¼ˆä¸»è¦å°±æ˜¯ Github è®¿é—®æ…¢â€¦ï¼‰;<br />
3.æˆ‘é€‰æ‹©çš„ Next ä¸»é¢˜æœ‰å†…ç½®çš„å›¾ç‰‡æ‡’åŠ è½½ï¼Œä¿®æ”¹å³å¯ï¼›</p>
<h2 id="5é”šç‚¹å¤±æ•ˆ"><a class="markdownIt-Anchor" href="#5é”šç‚¹å¤±æ•ˆ"></a> 5.é”šç‚¹å¤±æ•ˆ</h2>
<p>ä¸ç¡®å®šæ˜¯ä¸æ˜¯æ›´æ¢äº† <code>hexo-renderer-markdown-it</code><br />
é€ æˆçš„é—®é¢˜ï¼Œåªè®°å¾—ä¸€å¼€å§‹é”šç‚¹æœ‰æ•ˆçš„ï¼Œåæ¥å¶ç„¶å‘ç°é”šç‚¹å¤±æ•ˆäº†ï¼Œç»æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°æ˜¯æ ‡é¢˜æ¸²æŸ“æ²¡æœ‰ <code>id</code> å±æ€§ã€‚</p>
<p>åœ¨é˜…è¯» <a target="_blank" rel="noopener" href="https://convivae.top/posts/hexo-bo-ke-cai-keng/">Hexo åšå®¢è¸©å‘</a> ä¸€æ–‡åï¼Œå¢åŠ å¯¹è¿™ä¸ªé—®é¢˜çš„è®¤è¯†ã€‚åŸºäº Less is More<br />
çš„åŸåˆ™ï¼Œå†³å®šä¸é‡‡ç”¨å¢æ·»æ’ä»¶ï¼Œä¿®æ”¹æºç çš„æ–¹å¼äº†ã€‚æ—¢ç„¶æ¸²æŸ“å¼•æ“æ²¡æ³•æ­£å¸¸ç»™æ ‡é¢˜çš„æ·»åŠ  <code>id</code> å±æ€§ï¼Œå’±ä»¬è‡ªå·±æ‰‹åŠ¨ç»™å®ƒåŠ ä¸Šä¸å°±å¥½äº†å—:<br />
stuck_out_tongue_winking_eye:ï¼Ÿ</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">### 1.å¼•è¨€</span></span><br><span class="line"></span><br><span class="line">// çœ‹ï¼Œç›¸å¯¹äºæ¥å¢åŠ æ’ä»¶æ¥è¯´ï¼Œè¿™æ ·ä¸æ˜¯æ›´ç®€å•</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;å¼•è¨€&quot;</span>&gt;</span></span>1.å¼•è¨€<span class="language-xml"><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="6spawn-failed"><a class="markdownIt-Anchor" href="#6spawn-failed"></a> 6.Spawn failed</h2>
<blockquote>
<p>2021/03/31</p>
</blockquote>
<p>ä»Šå¤©æ›´æ–°äº†ä¸€ä¸‹ç›¸å†Œï¼Œæœ€åæ¨é€çš„æ—¶å€™ï¼Œçˆ†å‡ºäº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Connection reset by xxx.xxx.xxx.xxx port 22</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">FATAL &#123;</span><br><span class="line">  err: Error: Spawn failed</span><br><span class="line">      at ChildProcess.&lt;anonymous&gt; (D:\xx\...\node_modules\hexo-deployer-git\node_modules\hexo-util\lib\spawn.js:51:21)</span><br><span class="line">      at ChildProcess.emit (events.js:210:5)</span><br><span class="line">      at ChildProcess.cp.emit (D:\xx\...\node_modules\cross-spawn\lib\enoent.js:34:29)</span><br><span class="line">      at Process.ChildProcess._handle.onexit (internal/child_process.js:272:12) &#123;</span><br><span class="line">    code: 128</span><br><span class="line">  &#125;</span><br><span class="line">&#125; Something&#x27;s wrong. Maybe you can find the solution here: %s https://hexo.io/docs   s/troubleshooting.html</span><br></pre></td></tr></table></figure>
<p>ä¹‹å‰æ²¡è§è¿‡è¿™ç±»æŠ¥é”™ï¼Œäºæ˜¯å°±æŸ¥æŸ¥ <code>Spawn failed</code> ä½¿ä»€ä¹ˆé—®é¢˜å¯¼è‡´çš„ã€‚ï¼ˆè™½ç„¶ä¸çŸ¥é“å…·ä½“æŠ¥é”™åŸå› ï¼Œä½†ç›´è§‰æ˜¯ç½‘ç»œé“¾æ¥é—®é¢˜ï¼Œå¤šè¯•å‡ æ¬¡å°±å¥½äº†ã€‚ã€‚ã€‚ï¼‰</p>
<p>åé¢è¯•äº†ä¸¤æ¬¡å¹¶æ²¡æœ‰å¥½è½¬ï¼ŒåŒæ—¶ä¹Ÿåœ¨æŸ¥è¿™ä¸ªé—®é¢˜ï¼Œç½‘é¡µä¸Šçœ‹åˆ°çš„éƒ½æ˜¯è¯´åˆ é™¤ä»€ä¹ˆä»€ä¹ˆæ–‡ä»¶ï¼Œæ„Ÿè§‰ä¸é è°±ï¼Œäºæ˜¯æˆ‘å†è¯•äº†ä¸€æ¬¡ï¼Œè¿™ä¸€æ¬¡æ­£å¸¸æ¨é€äº†ã€‚å†åè¿‡å¤´çœ‹é‚£äº›å›ç­”ï¼ŒåŸºæœ¬éƒ½åªä¼šå‘Šè¯‰ä½ æ€ä¹ˆè§£å†³ï¼Œä½†æ²¡æœ‰ä¸€ä¸ªå¯ä»¥å‘Šè¯‰ä½ åŸå› æ˜¯ä»€ä¹ˆã€‚ã€‚ã€‚è¿™å°±å¾ˆè¿·ï¼</p>
<p>å…¶å®æƒ³æƒ³ï¼Œå„ç§ â€œbugâ€œ å¯èƒ½ä¼šå‡ºå¾—å¥‡å¥‡æ€ªæ€ªï¼Œä½†è‡³å°‘è¿˜æœ‰æœ‰ä¸€å®šé€»è¾‘å› ç´ çš„ã€‚ä¹‹å‰æ­£å¸¸ï¼Œçªç„¶å†’å‡ºçš„é—®é¢˜ï¼Œåœ¨â€œç¯å¢ƒâ€æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹ï¼Œé‚£å¤§æ¦‚æœ€å¤§å¯èƒ½å°±æ˜¯ç½‘ç»œé—®é¢˜äº†ã€‚ï¼ˆåŒæ ·ï¼Œåœ¨æ²¡æœ‰æŸ¥å‡ºè¿™ä¸ªæŠ¥é”™é—®é¢˜çš„æˆ‘æ¥è¯´ï¼Œä¹Ÿä¸ä¸€å®šå°±æ˜¯æ­£ç¡®çš„ï¼‰</p>
<h2 id="7ç½®é¡¶åŠŸèƒ½"><a class="markdownIt-Anchor" href="#7ç½®é¡¶åŠŸèƒ½"></a> 7.ç½®é¡¶åŠŸèƒ½</h2>
<blockquote>
<p>2021/06/20</p>
</blockquote>
<p>æœ€è¿‘æƒ³ç€å¼„ä¸€ä¸ªæ–‡ç« ç½®é¡¶ï¼Œç„¶åå‘ç°ç½‘ä¸Šçš„æ–¹æ³•è¿˜æ˜¯å¥½å‡ å¹´å‰ï¼Œå¹¶ä¸” <code>hexo-generator-index</code> æ—©å·²æ›´æ–°åˆ° 2.0 ç‰ˆæœ¬äº†ï¼Œä¼°è®¡ä¸é è°±ã€‚äºæ˜¯è‡ªå·±å»çœ‹äº†çœ‹æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">&#x27;hexo-pagination&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; sort &#125; = <span class="built_in">require</span>(<span class="string">&#x27;timsort&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">locals</span>) &#123;  </span><br><span class="line">  <span class="keyword">const</span> config = <span class="variable language_">this</span>.<span class="property">config</span>;  </span><br><span class="line">  <span class="keyword">const</span> posts = locals.<span class="property">posts</span>.<span class="title function_">sort</span>(config.<span class="property">index_generator</span>.<span class="property">order_by</span>);</span><br><span class="line">  <span class="title function_">sort</span>(posts.<span class="property">data</span>, (a, b) =&amp;gt; (b.<span class="property">sticky</span> || <span class="number">0</span>) - (a.<span class="property">sticky</span> || <span class="number">0</span>));</span><br><span class="line">  <span class="keyword">const</span> paginationDir = config.<span class="property">pagination_dir</span> || <span class="string">&#x27;page&#x27;</span>;  </span><br><span class="line">  <span class="keyword">const</span> path = config.<span class="property">index_generator</span>.<span class="property">path</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">pagination</span>(path, posts, &#123;    </span><br><span class="line">    <span class="attr">perPage</span>: config.<span class="property">index_generator</span>.<span class="property">per_page</span>,    </span><br><span class="line">    <span class="attr">layout</span>: [<span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;archive&#x27;</span>],    </span><br><span class="line">    <span class="attr">format</span>: paginationDir + <span class="string">&#x27;/%d/&#x27;</span>,    </span><br><span class="line">    <span class="attr">data</span>: &#123;<span class="attr">__index</span>: <span class="literal">true</span>&#125;&#125;);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ <code>sort(posts.data, (a, b) =&amp;gt; (b.sticky || 0) - (a.sticky || 0));</code> è¿™è¡Œä»£ç ï¼Œæ„Ÿè§‰æ˜¯ç”¨ <code>sticky</code><br />
ä½œä¸ºç½®é¡¶çš„å…³é”®å­—ï¼Œæ¯”æ•°å€¼å¤§å°å®šé¡ºåºï¼Œè‹¥æ²¡æœ‰æŒ‡å®šï¼Œåˆ™èµ‹å€¼ä¸º 0ï¼Œè¿›è¡Œæ—¥æœŸæ¯”è¾ƒï¼›åŒæ ·é€»è¾‘ï¼Œè‹¥æ˜¯ <code>sticky</code> ä¸€æ ·å¤§ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒæ—¥æœŸã€‚</p>
<p>éšä¾¿é€‰å–ä¸¤ç¯‡æ–‡ç« ï¼Œç¬¬ä¸€ç¯‡ï¼ˆæ—¥æœŸåœ¨å‰ï¼‰å…ˆè®¾ <code>sticky: 1</code>ï¼Œç„¶åæ–‡ç« ç½®é¡¶ï¼Œç„¶åé€‰ç¬¬äºŒç¯‡è®¾ç½® <code>stickty</code>ï¼Œé¢„æœŸä¹‹å†…ğŸ˜„ğŸ˜„<br />
ï¼ŒåŒæ ·ç½®é¡¶ï¼Œä¸”åœ¨ç¬¬ä¸€ç¯‡å‰é¢ã€‚</p>
<h2 id="8optipng-bin-gifsicle"><a class="markdownIt-Anchor" href="#8optipng-bin-gifsicle"></a> 8.<code>optipng-bin</code> &amp; <code>gifsicle</code></h2>
<blockquote>
<p>2021/10/28</p>
</blockquote>
<p>åœ¨ ubuntu ç³»ç»Ÿå†è£…åšå®¢ï¼Œå®‰è£… <code>hexo</code> å’Œ <code>gulp</code> è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å…·ä½“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ubuntu 20.04.3 LTS x86_64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">node v14.18.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm 6.14.15</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm config get registry https://registry.npm.taobao.org/</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">optipng-bin@6.0.0 postinstall /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/optipng-bin</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">node lib/install.js</span></span><br><span class="line"></span><br><span class="line">  âš  unable to verify the first certificate</span><br><span class="line">  âš  optipng pre-build test failed</span><br><span class="line">  â„¹ compiling from source</span><br><span class="line">  âœ– Error: Command failed: /bin/sh -c ./configure --with-system-zlib --prefix=&quot;/home/ym/Documents/gitproject/richardmyu.github.io/node_modules/optipng-bin/vendor&quot; --bindir=&quot;/home/ym/Documents/gitproject/richardmyu.github.io/node_modules/optipng-bin/vendor&quot;</span><br><span class="line"></span><br><span class="line">Checking for gcc...</span><br><span class="line">Using pre-configured libpng...</span><br><span class="line">Checking for system zlib...</span><br><span class="line">./configure: error: missing zlib or incorrect zlib version</span><br><span class="line">./configure: note: zlib version 1.2.1 or higher is required</span><br><span class="line"></span><br><span class="line">    at /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/bin-build/node_modules/execa/index.js:231:11</span><br><span class="line">    at runMicrotasks (&lt;anonymous&gt;)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:95:5)</span><br><span class="line">    at async Promise.all (index 0)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">gifsicle@5.1.0 postinstall /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/gifsicle</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">node lib/install.js</span></span><br><span class="line"></span><br><span class="line">  âš  unable to verify the first certificate</span><br><span class="line">  âš  gifsicle pre-build test failed</span><br><span class="line">  â„¹ compiling from source</span><br><span class="line">  âœ– Error: Command failed: /bin/sh -c autoreconf -ivf</span><br><span class="line">/bin/sh: 1: autoreconf: not found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    at /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/bin-build/node_modules/execa/index.js:231:11</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:95:5)</span><br><span class="line">    at async Promise.all (index 0)</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯å…³é”®è¯</strong></p>
<p><strong>optpng-bin</strong>ã€<strong>zlib</strong>ã€<strong>gifsicle</strong>ã€<strong>autoreconf</strong></p>
<p><strong>é”™è¯¯è¯­å¥</strong></p>
<ul>
<li><code>Error: Command failed: /bin/sh -c ./configure --with-system-zlib ...</code></li>
<li><code>./configure: error: missing zlib or incorrect zlib version</code></li>
<li><code>Error: Command failed: /bin/sh -c autoreconf -ivf</code></li>
<li><code>/bin/sh: 1: autoreconf: not found</code></li>
</ul>
<p><strong>å…¶ä»–æç¤ºä¿¡æ¯</strong></p>
<ul>
<li><code>unable to verify the first certificate</code></li>
<li><code>optipng/gifsicle pre-build test failed</code></li>
<li><code>./configure: note: zlib version 1.2.1 or higher is required</code></li>
</ul>
<h4 id="1è§£å†³-unable-to-verify-the-first-certificate"><a class="markdownIt-Anchor" href="#1è§£å†³-unable-to-verify-the-first-certificate"></a> 1.è§£å†³ <code>unable to verify the first certificate</code></h4>
<p>é€ æˆè¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºä½¿ç”¨äº†ä»£ç†ã€‚</p>
<p>1.ç„¶è€Œåœ¨å…³é—­ä»£ç†åï¼ˆä¹Ÿæ¸…é™¤äº† <code>config</code> å†…çš„ä»£ç†é…ç½®ä¿¡æ¯ï¼‰ï¼Œä¾æ—§æ²¡æœ‰æˆåŠŸï¼ŒæŠ¥å¦‚ä¸‹é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">connect ECONNREFUSED 0.0.0.0:443</span><br></pre></td></tr></table></figure>
<p>2.ä½¿ç”¨ä»£ç†ï¼Œå¹¶è®¾ç½® <code>strict-ssl=false</code></p>
<p>äº‹å®ä¸Šï¼Œæˆ‘çš„ <code>npm config</code> å·²ç»è®¾ç½®äº† <code>strict-ssl=false</code>ï¼Œç„¶è€Œå¹¶æ²¡æœ‰è§£å†³é—®é¢˜ã€‚</p>
<h4 id="2missing-zlib-or-incorrect-zlib-version-autoreconf-not-found"><a class="markdownIt-Anchor" href="#2missing-zlib-or-incorrect-zlib-version-autoreconf-not-found"></a> 2.<code>missing zlib or incorrect zlib version</code> &amp; <code>autoreconf: not found</code></h4>
<p>è¿™ä¸¤ä¸ªåœ¨ç³»ç»Ÿé‡Œç¡®å®æ²¡æœ‰ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€å®‰è£…ä¸€ä¸‹ï¼Œä½†æˆ‘è§‰å¾—ä¸æ˜¯è¿™ä¸ªçš„åŸå› ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">autoreconf -- autoconf</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zlib       -- zlib1g</span></span><br><span class="line">sudo apt install zlib1g autoconf</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸è¦å®‰è£…äº†ï¼Œå› ä¸ºå®‰è£…äº†ä½œç”¨æ²¡ä½“ç°ï¼Œåè€Œå¸è½½çš„æ—¶å€™ï¼Œç»‘å®šäº†è®¸å¤šé‡è¦çš„åŸºç¡€åŒ…ï¼š</p>
<p>ã€è­¦å‘Šã€‘ï¼šä¸‹åˆ—åŸºç¡€è½¯ä»¶åŒ…å°†è¢«å¸è½½ã€‚<br />
è¯·å‹¿å°è¯•ï¼Œé™¤éæ‚¨ç¡®å®çŸ¥é“æ‚¨åœ¨åšä»€ä¹ˆï¼<br />
apt adduser (æ˜¯ç”±äº apt) gpgv (æ˜¯ç”±äº apt) libapt-pkg6.0 (æ˜¯ç”±äº apt) dash dpkg (æ˜¯ç”±äº dash)<br />
debconf (æ˜¯ç”±äº dash) zlib1g (æ˜¯ç”±äº dpkg) grep install-info (æ˜¯ç”±äº grep) gzip init<br />
systemd-sysv (æ˜¯ç”±äº init) init-system-helpers (æ˜¯ç”±äº init) perl-base (æ˜¯ç”±äº init-system-helpers)<br />
login libpam0g (æ˜¯ç”±äº login) libpam-runtime (æ˜¯ç”±äº login) libpam-modules (æ˜¯ç”±äº login) mount<br />
util-linux (æ˜¯ç”±äº mount) shim-signed grub-efi-amd64-signed (æ˜¯ç”±äº shim-signed)<br />
grub2-common (æ˜¯ç”±äº shim-signed) mokutil (æ˜¯ç”±äº shim-signed) sbsigntool (æ˜¯ç”±äº shim-signed)<br />
sysvinit-utils</p>
</blockquote>
<p>å®‰è£…åçš„ç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">gifsicle@5.2.1 postinstall /home/ym/Documents/gitProject/richardmyu.github.io/node_modules/gifsicle</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">node lib/install.js</span></span><br><span class="line">    unable to verify the first certificate</span><br><span class="line">    gifsicle pre-build test failed</span><br><span class="line">    compiling from source</span><br><span class="line">    Error: Command failed: /bin/sh -c autoreconf -ivf</span><br><span class="line">    autoreconf: Entering directory `.&#x27;</span><br><span class="line">    autoreconf: configure.ac: not using Gettext</span><br><span class="line">    autoreconf: running: aclocal  --output=aclocal.m4t</span><br><span class="line">    Can&#x27;t exec &quot;aclocal&quot;: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• at /usr/share/autoconf/Autom4te/FileUtils.pm line 326.</span><br><span class="line">    autoreconf: failed to run aclocal: No such file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    at /home/ym/Documents/gitProject/richardmyu.github.io/node_modules/bin-build/node_modules/execa/index.js:231:11</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:95:5)</span><br><span class="line">    at async Promise.all (index 0)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">mozjpeg@6.0.1 postinstall /home/ym/Documents/gitProject/richardmyu.github.io/node_modules/mozjpeg</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">node lib/install.js</span></span><br><span class="line"></span><br><span class="line">  âš  unable to verify the first certificate</span><br><span class="line">  âš  mozjpeg pre-build test failed</span><br><span class="line">  â„¹ compiling from source</span><br><span class="line">  âœ– RequestError: unable to verify the first certificate</span><br><span class="line">    at ClientRequest.&lt;anonymous&gt; (/home/ym/Documents/gitProject/richardmyu.github.io/node_modules/got/index.js:111:21)</span><br><span class="line">    at Object.onceWrapper (events.js:520:26)</span><br><span class="line">    at ClientRequest.emit (events.js:400:28)</span><br><span class="line">    at TLSSocket.socketErrorListener (_http_client.js:475:9)</span><br><span class="line">    at TLSSocket.emit (events.js:400:28)</span><br><span class="line">    at emitErrorNT (internal/streams/destroy.js:106:8)</span><br><span class="line">    at emitErrorCloseNT (internal/streams/destroy.js:74:3)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:82:21)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">optipng-bin@6.0.0 postinstall /home/ym/Documents/gitProject/richardmyu.github.io/node_modules/optipng-bin</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">node lib/install.js</span></span><br><span class="line"></span><br><span class="line">  âš  unable to verify the first certificate</span><br><span class="line">  âš  optipng pre-build test failed</span><br><span class="line">  â„¹ compiling from source</span><br><span class="line">  âœ– Error: Command failed: /bin/sh -c ./configure --with-system-zlib --prefix=&quot;/home/ym/Documents/gitProject/richardmyu.github.io/node_modules/optipng-bin/vendor&quot; --bindir=&quot;/home/ym/Documents/gitProject/richardmyu.github.io/node_modules/optipng-bin/vendor&quot;</span><br><span class="line"></span><br><span class="line">Checking for gcc...</span><br><span class="line">Using pre-configured libpng...</span><br><span class="line">Checking for system zlib...</span><br><span class="line">./configure: error: missing zlib or incorrect zlib version</span><br><span class="line">./configure: note: zlib version 1.2.1 or higher is required</span><br><span class="line"></span><br><span class="line">    at /home/ym/Documents/gitProject/richardmyu.github.io/node_modules/bin-build/node_modules/execa/index.js:231:11</span><br><span class="line">    at runMicrotasks (&lt;anonymous&gt;)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:95:5)</span><br><span class="line">    at async Promise.all (index 0)</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.13 (node_modules/glob-watcher/node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.13: wanted &#123;&quot;os&quot;:&quot;darwin&quot;,&quot;arch&quot;:&quot;any&quot;&#125; (current: &#123;&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;x64&quot;&#125;)</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.1.3 (node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.1.3: wanted &#123;&quot;os&quot;:&quot;darwin&quot;,&quot;arch&quot;:&quot;any&quot;&#125; (current: &#123;&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;x64&quot;&#125;)</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: gifsicle@5.2.1 (node_modules/gifsicle):</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: gifsicle@5.2.1 postinstall: `node lib/install.js`</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status 1</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: optipng-bin@6.0.0 (node_modules/optipng-bin):</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: optipng-bin@6.0.0 postinstall: `node lib/install.js`</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: Exit status 1</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>gifsicle</code>ã€<code>mozjpeg</code> å’Œ <code>optipng-bin</code> çš„å®‰è£…éƒ½å‡ºäº†é—®é¢˜ï¼Œé™¤äº† <code>mozjpeg</code><br />
æ˜¯è¯ä¹¦é—®é¢˜ï¼Œå¦å¤–ä¸¤ä¸ªåŸºæœ¬è¿˜æ˜¯å› ä¸º <code>autoreconf</code> å’Œ <code>zlib</code>ã€‚</p>
<p>å½“æˆ‘å‡†å¤‡æ”¾å¼ƒçš„æ—¶å€™ï¼Œåˆè¿æ¥çš„å¸Œæœ›ä¹‹å…‰ã€‚</p>
<p>æˆ‘å‡çº§äº† <code>node</code>ï¼Œåˆ° <code>16.13.0</code> ç‰ˆæœ¬ï¼Œä¸Šè¿°é—®é¢˜éƒ½æ²¡æœ‰äº†ï¼Œæ²¡æœ‰äº†ï¼Œæ²¡äº†ã€‚ã€‚ã€‚ğŸ˜„ï¼Œä½†ç»™äº†ä¸€å †è­¦å‘Šï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm WARN old lockfile </span><br><span class="line">npm WARN old lockfile The package-lock.json file was created with an old version of npm,</span><br><span class="line">npm WARN old lockfile so supplemental metadata must be fetched from the registry.</span><br><span class="line">npm WARN old lockfile </span><br><span class="line">npm WARN old lockfile This is a one-time fix-up, please be patient...</span><br><span class="line">npm WARN old lockfile </span><br><span class="line">npm WARN deprecated gulp-minify-css@1.2.4: Please use gulp-clean-css</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated</span><br><span class="line">npm WARN deprecated gulp-util@3.0.8: gulp-util is deprecated - replace it, following the guidelines at https://medium.com/gulpjs/gulp-util-ca3b1f9f9ac5</span><br><span class="line">npm WARN deprecated fsevents@1.2.13: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.</span><br><span class="line">npm WARN deprecated chokidar@2.1.8: Chokidar 2 will break on node v14+. Upgrade to chokidar 3 with 15x less dependencies.</span><br><span class="line">npm WARN deprecated querystring@0.2.0: The</span><br><span class="line">npm WARN deprecated svgo@1.3.2: This SVGO version is no longer supported. Upgrade to v2.x.x.</span><br><span class="line">npm WARN deprecated highlight.js@9.18.5: Support has ended for 9.x series. Upgrade to @latest</span><br></pre></td></tr></table></figure>
<blockquote>
<p>éšè—çš„é—®é¢˜åœ¨ä¸€ä¸ªé—®é¢˜é‡Œè¯´æ˜ã€‚</p>
</blockquote>
<h4 id="3-ignore-scripts"><a class="markdownIt-Anchor" href="#3-ignore-scripts"></a> 3.<code>--ignore-scripts</code></h4>
<p>å…¶å®ä½¿ç”¨å‚è€ƒ[4] çš„æ–¹æ³•ï¼ˆå‘½ä»¤åé¢æ·»åŠ  <code>--ignore-scripts</code> å‚æ•°ï¼‰ï¼Œç¡®å®ä¹Ÿå¯ä»¥æˆåŠŸå®‰è£… <code>optipng-bin</code> å’Œ <code>gifsicle</code>ï¼Œä½†ä¸çŸ¥é“æœ‰æ²¡æœ‰å…¶ä»–å½±å“ã€‚</p>
<blockquote>
<p><strong>æ›´æ–°</strong> 2021/10/30</p>
</blockquote>
<p>é‡è£…ç³»ç»Ÿäº†ï¼Œäºæ˜¯å†³å®šå†æ¥è¯•ä¸€è¯•ï¼Œç»“æœæ²¡æœ‰å‡ºç°ä»¥ä¸Šçš„é—®é¢˜ï¼Œå› ä¸ºå‡ºç°çš„å…¶ä»–äº”èŠ±å…«é—¨çš„é”™ï¼Œç”šè‡³ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm install</span>                                    </span><br><span class="line">npm ERR! Unexpected token &lt; in JSON at position 0 while parsing near &#x27;&lt;!DOCTYPE html&gt;</span><br><span class="line">npm ERR! &lt;htm...&#x27;</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /home/ym/.npm/_logs/2021-11-02T11_37_54_847Z-debug.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ„Ÿè§‰åˆå›åˆ°äº† 17 å¹´çš„ <code>npm</code>ï¼š</p>
<blockquote>
<p>ä½ å¥½ï¼Œæˆ‘ä»¬ä¸ºä½ å®‰è£…äº†ä¸ƒä¸ªåŒ…ï¼Œå¸è½½äº†åä¸‰ä¸ªåŒ…ã€‚</p>
</blockquote>
<blockquote>
<p><strong>æ›´æ–°</strong> 2021/10/30</p>
</blockquote>
<p>æ²¡æœ‰ä¸Šé¢é‚£äº›ä¹±ä¸ƒå…«ç³Ÿçš„é”™è¯¯äº†ï¼Œä½†æ˜¯å›åˆ°è¿™ä¸ªé—®é¢˜çš„æœ€åˆçŠ¶æ€ï¼Œå³ <code>gifsicle</code> å’Œ <code>optipng-bin</code> çš„å®‰è£…é—®é¢˜ã€‚</p>
<hr />
<p>å‚è€ƒï¼š<br />
1.<a target="_blank" rel="noopener" href="https://github.com/p2227/p2227.github.io/issues/5">npm æç¤º unable to verify the first certificate çš„è§£å†³å°ç»“ #5</a><br />
2.<a target="_blank" rel="noopener" href="https://github.com/npm/npm/issues/20949">npm: unable to verify the first certificate #20949</a><br />
3.<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40033794/yarn-unable-to-verify-the-first-certificate/40350239#40350239">Yarn: unable to verify the first certificate</a><br />
4.<a target="_blank" rel="noopener" href="https://blog.csdn.net/feinifi/article/details/106680361">npm install optipng-bin Failed at the optipng-bin@7.0.0 postinstall script</a></p>
<h2 id="9gulp-imagemin"><a class="markdownIt-Anchor" href="#9gulp-imagemin"></a> 9.<code>gulp-imagemin</code></h2>
<blockquote>
<p>2021/10/30</p>
</blockquote>
<p>åœ¨ä¸Šè¿°æ¡ä»¶ä¸‹ï¼Œå®‰è£…å®Œæˆã€‚ç„¶åæ‰§è¡Œ <code>npx hexo clean</code> å’Œ <code>npx hexo g</code>ï¼Œæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒæŒ‰ç…§æµç¨‹ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ <code>gulp</code>ï¼Œå‹ç¼©æ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[22:38:16] Error in plugin &quot;gulp-imagemin&quot;</span><br><span class="line">Message:</span><br><span class="line">    spawn /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/imagemin-optipng/node_modules/optipng-bin/vendor/optipng ENOENT</span><br><span class="line">Details:</span><br><span class="line">    errno: -2</span><br><span class="line">    code: ENOENT</span><br><span class="line">    syscall: spawn /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/imagemin-optipng/node_modules/optipng-bin/vendor/optipng</span><br><span class="line">    path: /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/imagemin-optipng/node_modules/optipng-bin/vendor/optipng</span><br><span class="line">    spawnargs: -strip,all,-clobber,-o,3,-out,/tmp/a9f76343-d171-410a-a397-7c6be5040b24,-fix,/tmp/925435cc-4b38-4220-8d8f-fbc1abef0562</span><br><span class="line">    killed: false</span><br><span class="line">    stdout: </span><br><span class="line">    stderr: </span><br><span class="line">    failed: true</span><br><span class="line">    signal: null</span><br><span class="line">    cmd: /home/ym/Documents/gitproject/richardmyu.github.io/node_modules/imagemin-optipng/node_modules/optipng-bin/vendor/optipng -strip all -clobber -o 3 -out /tmp/a9f76343-d171-410a-a397-7c6be5040b24 -fix /tmp/925435cc-4b38-4220-8d8f-fbc1abef0562</span><br><span class="line">    timedOut: false</span><br><span class="line">    fileName: /home/ym/Documents/gitproject/richardmyu.github.io/public/images/apple-touch-icon-next.png</span><br><span class="line">    domainEmitter: [object Object]</span><br><span class="line">    domainThrown: false</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ–‡ä»¶ï¼Œå‘ç° <code>vendor</code> ä¸‹æ²¡æœ‰ <code>optipng</code>ï¼Œåªæœ‰ä¸€ä¸ª <code>source</code> ç›®å½•ã€‚æ‰€ä»¥è¯´å‡çº§ <code>node</code> å¹¶æ²¡æœ‰è§£å†³ <code>gulp-imagemin</code> çš„é—®é¢˜ã€‚</p>
<p>æ‰¾äº†ä¸€åœˆï¼Œå”¯ä¸€æœ‰ç›¸åŒæŠ¥é”™çš„ï¼Œæ²¡æœ‰è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰ä¸€ä¸ªä¸é è°±çš„å¸è½½é‡è£…ã€‚<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/38499668/got-enoent-error-with-gulp-image">Got ENOENT error with gulp-image</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ‰äººè¯´ç”¨ `cnpm` å¯ä»¥ï¼Œæˆ‘å°±è¯•äº†ä¸€ä¸‹ï¼Œç¡®å®å¯ä»¥</span></span><br><span class="line">npm uninstall --save-dev gulp-imagemin</span><br><span class="line">npm install -g cnpm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿…é¡»åˆ¶å®š 7.1ï¼Œå› ä¸ºæ–°ç‰ˆæœ¬ï¼ˆ8.0ï¼‰æ”¹ä¸º ESM</span></span><br><span class="line">cnpm install --save-dev gulp-imagemin@7.1</span><br></pre></td></tr></table></figure>
<p>å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºæœ‰å¾ˆå¤šè¢«åºŸå¼ƒçš„ï¼Œä½†ç°åœ¨çœŸä¸æƒ³ä¸€ä¸ªä¸€ä¸ªå»æ¢ï¼ˆæœ‰çš„ä¼šæç¤ºæ›¿ä»£å“ï¼Œæœ‰çš„æç¤ºå‡çº§ï¼Œå…¶å®å‡çº§ä¹Ÿæœ‰é£é™©ï¼ŒçœŸä¸çŸ¥é“ç‰ˆæœ¬å…¼ä»»æœ‰å¤šå°‘é—®é¢˜ï¼›æœ‰çš„å°±è¯´åºŸå¼ƒäº†ï¼Œæ²¡äº†ã€‚ã€‚ã€‚:<br />
cry:ï¼‰ã€‚</p>
<p>å¸è½½ä»¥åä½¿ç”¨ <code>cnpm</code> å®‰è£…å°±æ²¡æœ‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼ŸğŸ˜•ğŸ˜•ğŸ˜• ğŸ˜¤ğŸ˜¤ğŸ˜¤</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨ <code>meld</code> æ£€æµ‹ä¸‰ç§ <code>gulp-imagemin</code> æ–‡ä»¶ï¼š</p>
<p>1.æ—©æœŸ win10 ä¸Šå®‰è£…çš„ <code>gulp-imagemin</code> â€“ win-gi;<br />
2.å½“å‰æ—¶é—´ç”¨ <code>npm</code> å®‰è£…çš„ <code>gulp-imagemin</code> â€“ npm-gi;<br />
3.å½“å‰æ—¶é—´ç”¨ <code>cnpm</code> å®‰è£…çš„ <code>gulp-imagemin</code> â€“ cnpm-gi;</p>
<p>åœ¨ <code>package.json</code> ä¸­ï¼Œå‘ç°å½“å‰å®‰è£…çš„ json å°‘äº†å¾ˆå¤šæè¿°ï¼Œå¹¶ä¸”å°† <code>imagemin-gifsicle</code>ã€<code>imagemin-mozjpeg</code>ã€<code>imagemin-optipng</code><br />
å’Œ <code>imagemin-svg</code> ä»ç”Ÿäº§ä¾èµ–ç§»é™¤ï¼Œä¿ç•™åœ¨å¯é€‰ä¾èµ–(optionsalDependences)ä¸­ã€‚cnpm-gi ç›¸æ¯” npm-giï¼Œå¤šäº†ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;__npminstall_done&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;_from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp-imagemin@7.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;_resolved&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://registry.npmmirror.com/gulp-imagemin/download/gulp-imagemin-7.1.0.tgz&quot;</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä»–æ–‡ä»¶åŸºæœ¬ä¸€è‡´ï¼Œä¸¤ä»½ <code>package.json</code> å‡æœ‰ä¸Šè¿°åŒºåˆ«ã€‚ç›¸å¯¹ npm-gi æ¥è¯´ï¼Œcnpm-gi å¤šäº†è·Ÿ <code>gulp-iamgemin</code><br />
ç›¸å…³çš„åŒ…çš„é“¾æ¥åŒ…ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ <code>node_modules</code> ä¸­å¤§éƒ¨åˆ†åŒ…ï¼Œéƒ½æœ‰å¯¹åº”åˆ°ç‰ˆæœ¬çš„ä»¥ <code>_package-name@xx@buffer-alloc-unsafe</code> å‘½åçš„åŒ…ã€‚</p>
<p>æ€»ä¹‹ï¼Œæš‚æ—¶æ²¡æœ‰æ‰¾å‡º <code>npm</code> ä¸è¡Œè€Œ <code>cnpm</code> å¯ä»¥çš„åŸå› ã€‚</p>
<h2 id="10warning-accessing-non-existent-property-xxx-of-module-exports-inside-circular-dependency"><a class="markdownIt-Anchor" href="#10warning-accessing-non-existent-property-xxx-of-module-exports-inside-circular-dependency"></a> 10.<code>Warning: Accessing non-existent property 'xxx' of module exports inside circular dependency</code></h2>
<blockquote>
<p>2021/10/30</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">INFO  Start processing</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:56494) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br></pre></td></tr></table></figure>
<p>æ²¡å•¥å½±å“ï¼Œå°±æ˜¯çœ‹åˆ°ä¸èˆ’æœã€‚è¯´å¥½äº†ï¼Œä¿®å¤äº†ï¼Œç»“æœåœ¨é«˜ç‰ˆæœ¬è¿˜æ˜¯ä¸€æ ·ã€‚åˆ‡æ¢åˆ°ä½ç‰ˆæœ¬ï¼Œå¯ä»¥å›é¿è¿™ä¸ªé—®é¢˜ï¼Œä½†æ²¡å¿…è¦ã€‚</p>
<hr />
<p>1.<a target="_blank" rel="noopener" href="https://github.com/stylus/stylus/issues/2534"> NodeJS 14 warnings #2534 </a><br />
2.<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo-fs/pull/60"> fix: compatible with Node.js 14 #60</a><br />
3.<a target="_blank" rel="noopener" href="https://github.com/stylus/stylus/pull/2538"> Fix for Node v14 â€˜Accessing non-existent propertyâ€™ errors #2538 </a></p>
<h2 id="11å¤šç«¯åŒæ­¥"><a class="markdownIt-Anchor" href="#11å¤šç«¯åŒæ­¥"></a> 11.å¤šç«¯åŒæ­¥</h2>
<blockquote>
<p>2021/11/04</p>
</blockquote>
<p>å½“å‰ HEXO åšå®¢ï¼Œå®é™…æ˜¯å•é¡¹çš„ï¼Œå³æœ¬åœ°ä¿®æ”¹ä¸Šä¼ ã€‚è€Œåœ¨ github ä¸Šï¼Œæ˜¯å¯ä»¥ä¿®æ”¹åšå®¢çš„ <code>.md</code><br />
æ–‡ä»¶çš„ï¼Œè¿™æ ·æœ¬åœ°å°±æ— æ³•è·å–ã€‚å¤šç«¯åŒæ­¥ï¼Œäº¦æ˜¯åŒæ ·çš„ã€‚åœ¨å·²çŸ¥åšå®¢å†…å®¹ï¼ˆæœ¬åœ°å†…å®¹ç»è¿‡å¤„ç†çš„ï¼‰æ˜¯é€šè¿‡ <code>hexo-deployer-git</code><br />
è‡ªåŠ¨æ¨é€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æ–¹æ³•å®ç°æœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶çš„åŒæ­¥ã€‚ä¸€èˆ¬æœ‰æ–°å»ºè¿œç¨‹ä»“åº“çš„ï¼Œä¹Ÿæœ‰é€šè¿‡åˆ†æ”¯çš„ã€‚</p>
<p>åŸæœ¬æˆ‘æ˜¯æƒ³ç”¨åˆ†æ”¯çš„ï¼Œä½†çœ‹åˆ° <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/one-command-deployment#%E8%BF%99%E4%B8%80%E5%88%87%E6%98%AF%E5%A6%82%E4%BD%95%E5%8F%91%E7%94%9F%E7%9A%84%EF%BC%9F">hexo å®˜ç½‘â€“For ä½¿ç”¨ Git ç®¡ç†ç«™ç‚¹ç›®å½•çš„ç”¨æˆ·</a><br />
ï¼Œæ„Ÿè§‰å¾ˆè®¤å¯ï¼Œé‚æ”¹ä¸ºæ–°ä»“åº“ã€‚</p>
<h2 id="12husky"><a class="markdownIt-Anchor" href="#12husky"></a> 12.husky</h2>
<blockquote>
<p>2022/01/15</p>
</blockquote>
<p>ä¹‹å‰ä¸ºäº†å¤šç«¯å†™åšå®¢ï¼Œå¼„äº†ä¸€ä¸ªä»“åº“æ¥å­˜å‚¨é <code>public</code> éƒ¨åˆ†æ–‡ä»¶ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯æ¬¡å†™å®Œæ–‡ç« ï¼Œä¸€è¾¹è¦æ¨é€åšå®¢ï¼Œä¸€è¾¹è¦æäº¤ä»“åº“ï¼Œå¾ˆéº»çƒ¦ã€‚</p>
<p>åŸºç¡€çš„æ¨é€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ç¼–è¯‘</span><br><span class="line">hexo g -f</span><br><span class="line"></span><br><span class="line"># å‹ç¼©</span><br><span class="line">gulp</span><br><span class="line"></span><br><span class="line"># æ¨é€</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>
<p>ä¸å¦‚åœ¨ <code>package.json</code> ä¸­ï¼Œç”¨ä¸€è¡Œå‘½ä»¤æå®šï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;pb&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo g -f &amp;&amp; gulp &amp;&amp; hexo d&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>å³ä¾¿è¿™æ ·ï¼Œæ¯æ¬¡ï¼Œè¿˜æ˜¯å¾—åˆ†ä¸¤æ­¥ï¼šæ¨é€ï¼Œæäº¤ã€‚ä½†æ˜¯åŒè¿‡ gitHookï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆæ¨é€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">npm install husky -D</span><br><span class="line"># husky åˆå§‹åŒ–</span><br><span class="line">npx husky install</span><br><span class="line"># åˆ›å»º pre-commit hook</span><br><span class="line">npx husky add .husky/pre-commit &quot;npm run pb&quot;</span><br></pre></td></tr></table></figure>
<p>å¯¹ <code>package.json</code> ä¿®æ”¹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;pb&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hexo g -f &amp;&amp; gulp &amp;&amp; hexo d&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;husky&quot;</span> <span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run pb&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼ŒæŒ‰ç…§æ­£å¸¸ git æµç¨‹å°±å¯ä»¥äº†ã€‚</p>
<p>å½“ç„¶ï¼Œæœ‰äº›æ—¶å€™ï¼Œå¯èƒ½ä¼šæœ‰äº›ä¿®æ”¹ä¸æ–‡ç« æ— å…³ï¼Œå³ä¸éœ€è¦æ¨é€åˆ°åšå®¢ä¸Šçš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>--no-verify</code> è·³è¿‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git commit --no-verify -m&quot;xxx&quot;</span><br></pre></td></tr></table></figure>
<h2 id="13fatal-somethings-wrong"><a class="markdownIt-Anchor" href="#13fatal-somethings-wrong"></a> 13.FATAL Somethingâ€™s wrong.</h2>
<blockquote>
<p>2024/01/19</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">hexo:</span> <span class="number">7.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">hexo-cli:</span> <span class="number">4.3</span><span class="number">.1</span></span><br><span class="line"><span class="attr">os:</span> <span class="string">win32</span> <span class="number">10.0</span><span class="number">.22621</span></span><br><span class="line"><span class="attr">node:</span> <span class="number">20.11</span><span class="number">.0</span></span><br><span class="line"><span class="attr">hexo-theme-next:</span> <span class="number">8.19</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰åŠ¨ <code>themes/next/_config.yml</code>ï¼Œè€Œæ˜¯åœ¨æ ¹ç›®å½•æ·»åŠ äº†  <code>_config.next.yml</code> æ–‡ä»¶ï¼Œå¯¹ä¸»é¢˜çš„ä¿®æ”¹åœ¨æ­¤å¤„è¿›è¡Œã€‚</p>
<p>å¦‚ä½•æ¨é€æ—¶æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INFO  Start processing</span><br><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">TypeError: Cannot read properties of undefined (reading &#x27;enable&#x27;)</span><br><span class="line">    at C:\mywork\remote_project\hexo-source\themes\next\scripts\filters\comment\valine.js:11:21</span><br><span class="line">    at Filter.execSync (C:\mywork\remote_project\hexo-source\node_modules\hexo\dist\extend\filter.js:72:36)</span><br><span class="line">    at Hexo.execFilterSync (C:\mywork\remote_project\hexo-source\node_modules\hexo\dist\hexo\index.js:394:35)</span><br><span class="line">    at module.exports (C:\mywork\remote_project\hexo-source\themes\next\scripts\events\lib\injects.js:58:8)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (C:\mywork\remote_project\hexo-source\themes\next\scripts\events\index.js:11:27)</span><br><span class="line">    at Hexo.tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\method.js:15:34)</span><br><span class="line">    at C:\mywork\remote_project\hexo-source\node_modules\hexo\dist\extend\filter.js:58:67</span><br><span class="line">    at tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Object.gotValue (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\reduce.js:166:18)</span><br><span class="line">    at Object.gotAccum (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\reduce.js:155:25)</span><br><span class="line">    at Object.tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Promise._settlePromiseFromHandler (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:547:31)</span><br><span class="line">    at Promise._settlePromise (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">    at Promise._settlePromiseCtx (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:641:10)</span><br><span class="line">    at _drainQueueStep (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\async.js:97:12)</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æŠ¥é”™ä¿¡æ¯ï¼Œå…ˆå»æŸ¥çœ‹ <code>\themes\next\scripts\filters\comment\valine.js:11:21</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!theme.<span class="property">valine</span>.<span class="property">enable</span> || !theme.<span class="property">valine</span>.<span class="property">appid</span> || !theme.<span class="property">valine</span>.<span class="property">appkey</span>) <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æŠ¥é”™ä¿¡æ¯ <code>TypeError: Cannot read properties of undefined (reading 'enable')</code>ï¼Œå¯ä»¥ç¡®å®šæ˜¯ <code>theme.valine</code><br />
ä¸å­˜åœ¨ï¼Œè¿™æ—¶å€™éœ€è¦å»çœ‹çœ‹ä¸»é¢˜é…ç½®æ–‡ä»¶äº†ï¼ˆ<code>themes/next/_config.yml</code>ï¼‰ï¼Œç„¶åç¡®å®æ²¡æœ‰æ‰¾åˆ° <code>valine</code><br />
ç›¸å…³ä¿¡æ¯ï¼Œå»å®˜ç½‘<a target="_blank" rel="noopener" href="https://github.com/next-theme/hexo-theme-next/">https://github.com/next-theme</a><br />
æŸ¥æ‰¾ï¼Œç»ˆäºåœ¨ <a target="_blank" rel="noopener" href="https://github.com/next-theme/hexo-theme-next/issues/4">ã€å¿…è¯»ã€‘æ›´æ–°è¯´æ˜åŠå¸¸è§é—®é¢˜ #4</a>æ‰¾åˆ°è§£é‡Šäº†ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">v8.1.0 ç§»é™¤ Valine</span><br><span class="line">Valine ä½¿ç”¨ Leancloud ä½œä¸ºåç«¯ï¼Œæ˜¯ä¸€ä¸ªæ·±å—é™æ€åšå®¢ç”¨æˆ·å–œçˆ±çš„è¯„è®ºç³»ç»Ÿã€‚ç„¶è€Œ Valine æš´éœ²å‡ºäº†ä¸€äº›ä»¤äººæ‹…å¿§çš„é—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line">NexT å›¢é˜Ÿæ›¾å¤šæ¬¡æ”¶åˆ°å…³äº Valine è¯„è®ºç³»ç»Ÿå­˜åœ¨éšç§æ•°æ®æ³„éœ²çš„åé¦ˆï¼›</span><br><span class="line">Valine è‡ª 1.4 ç‰ˆæœ¬èµ·ä¸å†å¼€æºï¼Œå‘å¸ƒçš„æ‰“åŒ…ç‰ˆæœ¬ä¸­å­˜åœ¨æœªå‘ŠçŸ¥ç”¨æˆ·çš„ç™¾åº¦ç»Ÿè®¡ä»£ç ï¼›</span><br><span class="line">2020 å¹´ 11 æœˆä¸‹æ—¬å‡ºç°äº†é’ˆå¯¹ Valine çš„åƒåœ¾è¯„è®ºæ”»å‡»ï¼›</span><br><span class="line">[<span class="string">CVE-2021-34801</span>](<span class="link">https://github.com/advisories/GHSA-p2c4-gxp4-j3xp</span>)</span><br><span class="line">è€ƒè™‘åˆ°è¿™äº›é—®é¢˜å·²ç»ä¸¥é‡å½±å“åˆ° NexT ç”¨æˆ·çš„æ•°æ®å®‰å…¨ï¼Œæˆ‘ä»¬å†³å®šå°†å…¶ç§»é™¤ï¼Œéœ€è¦ç»§ç»­ä½¿ç”¨çš„ç”¨æˆ·è¯·å®‰è£…æ’ä»¶ï¼š https://github.com/next-theme/hexo-next-valine</span><br><span class="line">ï¼ˆæ’ä»¶çš„é…ç½®é¡¹ä½¿ç”¨é©¼å³°å‘½åï¼Œä¸ Valine æœ¬èº«ä¸€è‡´ï¼Œéœ€è¦æ³¨æ„å°† appid å’Œ appkey æ”¹ä¸º appId å’Œ appKeyï¼‰</span><br><span class="line">ç”±äº Valine ä¸å†å¼€æºï¼ŒNexT å›¢é˜Ÿæ— æ³•å¯¹å…¶ Debugã€‚å¦‚æœåœ¨ä½¿ç”¨æ—¶å‡ºç°ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¿™é‡Œåé¦ˆï¼š https://github.com/xCss/Valine/issues</span><br><span class="line">ä» Valine è¿ç§»åˆ° Disqusï¼š https://github.com/YunYouJun/valine-to-disqus</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œé—®é¢˜å·²è§£å†³ã€‚</p>
<p>1.ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆ<code>_config.next.yml</code>ï¼‰æ·»åŠ  <code>valine</code> ä¿¡æ¯ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">valine:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>2.ã€ä¸æ¨èã€‘ä¿®æ”¹ <code>\themes\next\scripts\filters\comment\valine.js</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!theme.<span class="property">valine</span> || !theme.<span class="property">valine</span>.<span class="property">enable</span> || !theme.<span class="property">valine</span>.<span class="property">appid</span> || !theme.<span class="property">valine</span>.<span class="property">appkey</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="comment">// æ³¨æ„ï¼Œé™¤äº†ç¬¬ 11 è¡Œï¼Œè¿˜æœ‰ç¬¬ 21 è¡Œ</span></span><br></pre></td></tr></table></figure>
<p><strong>æ›´æ–°</strong>ï¼š</p>
<p>v8.1 ç‰ˆæœ¬è¿˜æœ‰ <code>valine.js</code> æ–‡ä»¶ï¼Œv8.2 å·²ç»ç§»é™¤äº†ã€‚ç›´æ¥å®‰è£…æ–°ç‰ˆæœ¬ï¼ˆv8.2åŠä»¥ä¸Šï¼‰çš„æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä» v8.2 ä»¥ä¸‹ç‰ˆæœ¬å‡çº§çš„ï¼Œå¯èƒ½ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="14å¢åŠ ç›¸å†ŒåŠŸèƒ½"><a class="markdownIt-Anchor" href="#14å¢åŠ ç›¸å†ŒåŠŸèƒ½"></a> 14.å¢åŠ ç›¸å†ŒåŠŸèƒ½</h2>
<p>å‰ä¸€æ®µæ—¶é—´ï¼Œæ•´ç†æ‰‹æœºçš„æ—¶å€™ï¼Œå‘ç°æ‰‹æœºå†…çš„ç…§ç‰‡å¤ªå¤šäº†ï¼Œè€Œé‚£ä¸ªæ—¶å€™ä¹Ÿåœ¨å†™ä¸€äº›ä¹¦æ‘˜ï¼Œå°±æƒ³ç€ï¼Œè¦ä¸åœ¨åšå®¢ä¸Šå»ºç«‹ä¸€ä¸ªç›¸å†Œå§ï¼Ÿåœ¨æ­å»ºå’Œé…ç½®è¿™ä¸ªåšå®¢ï¼ˆHexo &amp;<br />
Nextï¼‰çš„æ—¶å€™ï¼Œå·²ç»çŸ¥é“ä¸æ”¯æŒç›¸å†ŒåŠŸèƒ½ï¼Œä½†å®åœ¨æ˜¯å¾ˆæƒ³å¼„ä¸€ä¸ªï¼Œäºæ˜¯ä¸Šç½‘æœæœçœ‹ï¼Œçœ‹ä¹Ÿæ²¡æœ‰å¯ä»¥å€Ÿé‰´çš„ã€‚</p>
<p>åœ¨çœ‹æ¥äº†å¤šä¸ªæ–‡ç« ä¹‹åï¼Œé€‰æ‹©äº†å…¶ä¸­å‡ ç¯‡æ¯”è¾ƒè¯¦å°½ï¼ŒåŠŸèƒ½æ¯”è¾ƒç¬¦åˆéœ€æ±‚çš„æ–‡ç« ä¸ºå€Ÿé‰´ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µï¼Œä»¥åŠè‡ªå·±çš„éœ€æ±‚ï¼Œåšå‡ºä¸€äº›ä¿®æ”¹å’Œè°ƒæ•´ï¼Œå¹¶åœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚</p>
<hr />
<p>1.<a target="_blank" rel="noopener" href="https://houmin.cc/posts/d487dd02/">Hexo NexT æ·»åŠ å¤šçº§ç›¸å†ŒåŠŸèƒ½</a><br />
2.<a target="_blank" rel="noopener" href="https://malizhi.cn/HexoAlbum/">æ­å»ºHexoåšå®¢ç›¸å†Œ</a><br />
3.<a target="_blank" rel="noopener" href="https://www.zywvvd.com/2020/04/22/next/23_get_image_info/get-image-info/">Next -23- æ·»åŠ ç›¸å†Œç³»åˆ— -3- è·å–å›¾åƒä¿¡æ¯ã€ä¿å­˜ä¸ºjsonæ–‡ä»¶å¹¶ä¸Šä¼ å›¾åƒ</a></p>
<h3 id="1å¢åŠ ç›¸å†Œ-tab"><a class="markdownIt-Anchor" href="#1å¢åŠ ç›¸å†Œ-tab"></a> 1.å¢åŠ ç›¸å†Œ tab</h3>
<p>æ§åˆ¶å°æ‰§è¡Œ <code>hexo new page &quot;album&quot;</code>ï¼Œç„¶åä¼šåœ¨ <code>source</code> æ–‡ä»¶çœ‹åˆ° <code>album</code> ä»¥åŠ <code>index.md</code> æ–‡ä»¶ã€‚</p>
<p>ç„¶ååœ¨ä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶ï¼ˆ<code>themes/next/_config.yml</code>ï¼‰å¢åŠ  tab:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="comment"># æ–°å¢</span></span><br><span class="line">  <span class="attr">album:</span> <span class="string">/album/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-camera</span></span><br></pre></td></tr></table></figure>
<p>å›¾æ ‡å¯ä»¥è‡ªå·±æ›´æ¢ï¼Œå¦‚æœæœ‰è¯­è¨€åˆ‡æ¢ï¼Œè®°å¾—å»ä¸»é¢˜çš„ <code>languages</code> æ–‡ä»¶å¢åŠ ç›¸å†Œçš„å¯¹åº”è¯­è¨€è¯æ±‡ã€‚</p>
<h3 id="2ä¸€çº§ç›¸å†Œ"><a class="markdownIt-Anchor" href="#2ä¸€çº§ç›¸å†Œ"></a> 2.ä¸€çº§ç›¸å†Œ</h3>
<blockquote>
<p>å•çº¯åªè¦ä¸€çº§ç›¸å†Œæ˜¯æŒºç®€å•çš„ã€‚ä½†è¿™é‡Œçš„ä¸€çº§ç›¸å†Œï¼Œæ˜¯è¦ä¸ºäºŒçº§ç›¸å†Œåšå‡†å¤‡çš„ã€‚</p>
</blockquote>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿æ¥ç”Ÿæˆ album é¡µé¢ï¼Œå…·ä½“æ˜¯åœ¨ <code>themes/next/layout</code> ä¸‹æ–°å»º <code>album.swig</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125;</span><br><span class="line">&#123;% import &#x27;_macro/sidebar.swig&#x27; as sidebar_template with context %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# æ·»åŠ ç›¸å†Œ title #&#125;</span><br><span class="line">&#123;% block title %&#125;&#123;&#123; page.title &#125;&#125; | &#123;&#123; title &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;div class=&quot;posts-expand&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;post-block&quot; lang=&quot;&#123;&#123; page.lang or page.language or config.language &#125;&#125;&quot;&gt;</span><br><span class="line">            &#123;# ä¸æƒ³åœ¨ç›¸å†Œé¡µé¢æ˜¾ç¤º â€œç›¸å†Œâ€ï¼Œåˆ™æ³¨é‡Šä¸‹ä¸€æ¡ä»£ç  #&#125;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/page-header.swig&#x27; %&#125; #&#125;</span><br><span class="line">            &lt;div class=&quot;post-body&#123;%- if page.direction and page.direction.toLowerCase() === &#x27;rtl&#x27; %&#125; rtl&#123;%- endif %&#125;&quot;&gt;</span><br><span class="line">                &#123;% if config.album %&#125;</span><br><span class="line">                &lt;div class=&quot;album-wrapper row&quot;&gt;</span><br><span class="line">                    &#123;% for gallery in config.album.gallery %&#125;</span><br><span class="line">                    &lt;div class=&quot;album-box&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;./&#123;&#123; gallery.name &#125;&#125;&quot; class=&quot;album-item&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;album-cover-box&quot; style=&quot;background-image: url(&#123;&#123; config.album.image_bed &#125;&#125;/&#123;&#123; gallery.name &#125;&#125;/thumbnail/&#123;&#123; gallery.cover &#125;&#125;);&quot;&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;p class=&quot;album-name&quot;&gt;</span><br><span class="line">                                &#123;&#123; gallery.name &#125;&#125;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;p class=&quot;album-description&quot;&gt;</span><br><span class="line">                            &#123;&#123; gallery.description &#125;&#125;</span><br><span class="line">                        &lt;p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block sidebar %&#125;</span><br><span class="line">  &#123;&#123; sidebar_template.render(true) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>ç»†èŠ‚ä¸Šï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œä¿®æ”¹è°ƒæ•´ã€‚ç„¶åè¦åœ¨<strong>ç«™ç‚¹</strong>é…ç½®æ–‡ä»¶(<code>_config.yml</code>)ä¸­ï¼Œæ·»åŠ ç›¸å†Œçš„ä¿¡æ¯ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">album:</span></span><br><span class="line">  <span class="attr">imageBed:</span> <span class="string">https://xxx.xx.com/album</span></span><br><span class="line">  <span class="attr">gallery:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºç›¸å†Œè€Œå·²ï¼Œè¿™é‡Œåªæ˜¯ç”Ÿæˆäº† html é¡µé¢ï¼Œå¦‚æœ‰éœ€è¦ä½ å¯ä»¥æ ¹æ® css æ¥å®šåˆ¶å¯¹åº”çš„æ ·å¼ã€‚è¿™é‡Œ css<br />
æ•°æ®æ”¾åœ¨äº†<code>souce/_data/styles.styl</code> ä¸­ã€‚</p>
<p>æœ€åä¿®æ”¹ <code>source/album/index.md</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">date: xxxx-xx-xx xx:xx:xx</span><br><span class="line">layout: album</span><br><span class="line"><span class="section">title: &#x27;ç›¸å†Œ&#x27;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
<p><code>layout: album</code> ç”¨æ¥æŒ‡å®šä½¿ç”¨ <code>album.swig</code> æ¥æ¸²æŸ“å‡ºç›¸å†Œçš„ HTML é¡µé¢ã€‚</p>
<h3 id="3äºŒçº§ç›¸å†Œ"><a class="markdownIt-Anchor" href="#3äºŒçº§ç›¸å†Œ"></a> 3.äºŒçº§ç›¸å†Œ</h3>
<p>åœ¨ <code>source/album</code> ä¸‹ï¼Œåˆ›å»º gallery ç›®å½•ï¼Œå…·ä½“æ˜¯æŒ‡ï¼Œæ ¹æ®ç«™ç‚¹é…ç½®ä¿¡æ¯ï¼Œå»ºç«‹å¯¹åº”çš„å›¾å†Œç›®å½•ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">album:</span></span><br><span class="line">  <span class="attr">imageBed:</span> <span class="string">https://xxx.xx.com/album</span></span><br><span class="line">  <span class="attr">gallery:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;flowers&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;sky&#x27;</span></span><br><span class="line">      <span class="attr">cover:</span> <span class="string">&#x27;xxx.jpg&#x27;</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&#x27;xx...xx&#x27;</span></span><br><span class="line">      <span class="attr">created:</span> <span class="string">&#x27;xxxx-xx-xx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹åº” gallery :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|-- album</span><br><span class="line">|    |</span><br><span class="line">|    |-- index.md</span><br><span class="line">|    |</span><br><span class="line">|    |-- flowers</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- data.json</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- index.md</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- sky</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- data.json</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- index.md</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- ...</span><br><span class="line">|</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯æè¿°ç›¸å†Œçš„ JSON æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ Python è„šæœ¬è‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°ï¼ˆåé¢æœ‰è®²è¿°ï¼‰ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;flowers&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx...xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxx-xx-xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;imageBed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://xxx.xxcom/album&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;items&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;caption&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx....xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxx-xx-xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xx,xxx,xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">6400</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">4000</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ gallery çš„ <code>index.md</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">date: xxxx-xx-xx xx:xx:xx</span><br><span class="line">fancybox: false</span><br><span class="line">layout: gallery</span><br><span class="line">title: &#x27;flowers&#x27;</span><br><span class="line"><span class="section">galleryName: &#x27;flowers&#x27;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œå°±è¦ç¼–å†™ gallery çš„æ¨¡æ¿äº†ã€‚è·Ÿä¸€çº§ç›¸å†Œä¸€æ ·ï¼Œè¿˜æ˜¯åœ¨åœ¨ <code>themes/next/layout</code> ä¸‹æ–°å»º <code>gallery.swig</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;% extends &#x27;_layout.swig&#x27; %&#125;</span><br><span class="line">&#123;% import &#x27;_macro/sidebar.swig&#x27; as sidebar_template with context %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;&#123;&#123; page.title &#125;&#125; | &#123;&#123; title &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;posts-expand&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;post-block&quot; lang=&quot;&#123;&#123; page.lang or page.language or config.language &#125;&#125;&quot;&gt;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/page-header.swig&#x27; %&#125; #&#125;</span><br><span class="line">            &lt;div class=&quot;post-body&#123;%- if page.direction and page.direction.toLowerCase() === &#x27;rtl&#x27; %&#125; rtl&#123;%- endif %&#125;&quot;&gt;</span><br><span class="line">                &lt;link rel=&quot;stylesheet&quot; href=&quot;/lib/album/photoswipe.css&quot;&gt;</span><br><span class="line">                &lt;link rel=&quot;stylesheet&quot; href=&quot;/lib/album/default-skin/default-skin.css&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# gallery body #&#125;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;gallery&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;gallery-description&quot;&gt;</span><br><span class="line">                        &lt;p id=&quot;gallery-description&quot;&gt;è¿™é‡Œæ˜¯ç›¸å†Œæè¿°&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div class=&quot;instagram itemscope&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;https://richyu.gitee.io/&quot; target=&quot;_blank&quot; class=&quot;open-ins&quot;&gt;å›¾ç‰‡æ­£åœ¨åŠ è½½ä¸­â€¦&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &#123;# gallery body end #&#125;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- Core JS file --&gt; #&#125;</span><br><span class="line">                &lt;script src=&quot;/lib/album/photoswipe.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- UI JS file --&gt; #&#125;</span><br><span class="line">                &lt;script src=&quot;/lib/album/photoswipe-ui-default.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">                &#123;# &lt;!-- gallery.js --&gt; #&#125;</span><br><span class="line">                &lt;script&gt;</span><br><span class="line">                    (function() &#123;</span><br><span class="line">                        var loadScript = function(path) &#123;</span><br><span class="line">                        var $script = document.createElement(&#x27;script&#x27;)</span><br><span class="line">                        document.getElementsByTagName(&#x27;body&#x27;)[0].appendChild($script)</span><br><span class="line">                        $script.setAttribute(&#x27;src&#x27;, path)</span><br><span class="line">                        &#125;</span><br><span class="line">                        setTimeout(function() &#123;</span><br><span class="line">                            loadScript(&#x27;/lib/album/gallery.min.js&#x27;)</span><br><span class="line">                        &#125;, 0)</span><br><span class="line">                    &#125;)()</span><br><span class="line">                &lt;/script&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &#123;# &#123;% include &#x27;_partials/page/breadcrumb.swig&#x27; %&#125; #&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;# &lt;!-- Root element of PhotoSwipe. Must have class pswp. --&gt; #&#125;</span><br><span class="line">    &lt;div class=&quot;pswp&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-hidden=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &#123;# &lt;!-- Background of PhotoSwipe.</span><br><span class="line">         It&#x27;s a separate element, as animating opacity is faster than rgba(). --&gt; #&#125;</span><br><span class="line">        &lt;div class=&quot;pswp__bg&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &#123;# &lt;!-- Slides wrapper with overflow:hidden. --&gt; #&#125;</span><br><span class="line">        &lt;div class=&quot;pswp__scroll-wrap&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &#123;# &lt;!-- Container that holds slides. PhotoSwipe keeps only 3 slides in DOM to save memory. --&gt; #&#125;</span><br><span class="line">            &#123;# &lt;!-- don&#x27;t modify these 3 pswp__item elements, data is added later on. --&gt; #&#125;</span><br><span class="line">            &lt;div class=&quot;pswp__container&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;pswp__item&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &#123;# &lt;!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --&gt; #&#125;</span><br><span class="line">            &lt;div class=&quot;pswp__ui pswp__ui--hidden&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__top-bar&quot;&gt;</span><br><span class="line"></span><br><span class="line">                    &#123;# &lt;!--  Controls are self-explanatory. Order can be changed. --&gt; #&#125;</span><br><span class="line">                    &lt;div class=&quot;pswp__counter&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--close&quot; title=&quot;Close (Esc)&quot;&gt;&lt;/button&gt;</span><br><span class="line">                    &#123;# &lt;button class=&quot;pswp__button pswp__button--share&quot; title=&quot;Share&quot;&gt;&lt;/button&gt; #&#125;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--fs&quot; title=&quot;Toggle fullscreen&quot;&gt;&lt;/button&gt;</span><br><span class="line">                    &lt;button class=&quot;pswp__button pswp__button--zoom&quot; title=&quot;Zoom in/out&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                    &#123;# &lt;!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --&gt; #&#125;</span><br><span class="line">                    &#123;# &lt;!-- element will get class pswp__preloader--active when preloader is running --&gt; #&#125;</span><br><span class="line">                    &lt;div class=&quot;pswp__preloader&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;pswp__preloader__icn&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;pswp__preloader__cut&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;pswp__preloader__donut&quot;&gt;&lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__share-modal pswp__share-modal--hidden pswp__single-tap&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;pswp__share-tooltip&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;button class=&quot;pswp__button pswp__button--arrow--left&quot; title=&quot;Previous (arrow left)&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                &lt;button class=&quot;pswp__button pswp__button--arrow--right&quot; title=&quot;Next (arrow right)&quot;&gt;&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div class=&quot;pswp__caption&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;pswp__caption__center&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block sidebar %&#125;</span><br><span class="line">  &#123;&#123; sidebar_template.render(true) &#125;&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œé¡µé¢åŸºæœ¬å®Œæˆï¼Œå‰©ä¸‹çš„å°±æ˜¯ç¼–å†™ <code>gallery.js</code> äº†ã€‚</p>
<h3 id="4ç¼–å†™è„šæœ¬"><a class="markdownIt-Anchor" href="#4ç¼–å†™è„šæœ¬"></a> 4.ç¼–å†™è„šæœ¬</h3>
<p>åœ¨ <code>themes/next/source/lib</code> ä¸‹ï¼Œæ–°å»º album ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸‹æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|</span><br><span class="line">|-- album</span><br><span class="line">|    |</span><br><span class="line">|    |-- assets</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- empty,png</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- default-skin</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.css</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.png</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- default-skin.svg</span><br><span class="line">|    |    |</span><br><span class="line">|    |    |-- preloader.gif</span><br><span class="line">|    |    |</span><br><span class="line">|    |</span><br><span class="line">|    |-- gallery.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- handler_photoswipe.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe-ui-default.min.js</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe.css</span><br><span class="line">|    |</span><br><span class="line">|    |-- photoswipe.min.js</span><br><span class="line">|    |</span><br><span class="line">|</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šè¿™äº›å›¾ç‰‡ä»¥åŠè„šæœ¬å‡å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/richardmyu/richardmyu.github.io/tree/main/lib/album">https://github.com/richardmyu/richardmyu.github.io/tree/main/lib/album</a><br />
ä¸­æ‰¾åˆ°ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªé‡ç‚¹åœ¨ <code>gallery.js</code> æ–‡ä»¶ä¸­ã€‚</p>
<p>è¿™æ˜¯å‚è€ƒæ–‡ç« ä¸­çš„è„šæœ¬ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;lazyloadjs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> photoswipe = <span class="built_in">require</span>(<span class="string">&quot;./handler_photoswipe.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> view = <span class="title function_">_interopRequireDefault</span>(photoswipe.<span class="property">viewer</span>);</span><br><span class="line"><span class="keyword">var</span> galleryPath = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line"><span class="keyword">var</span> galleryName = galleryPath.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> dataUrl = <span class="string">&#x27;/album/&#x27;</span> + galleryName + <span class="string">&#x27;/data.json&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> dataJSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_interopRequireDefault</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.<span class="property">__esModule</span> ? obj : &#123;</span><br><span class="line">    <span class="attr">default</span>: obj</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> render = <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">response</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> imageBed = response[<span class="string">&quot;image_bed&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> description = response[<span class="string">&quot;description&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> items = response[<span class="string">&quot;items&quot;</span>];</span><br><span class="line">  <span class="keyword">var</span> ulTmpl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> items) &#123;</span><br><span class="line">    <span class="keyword">var</span> liTmpl = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> date = item[<span class="string">&#x27;date&#x27;</span>]</span><br><span class="line">    <span class="keyword">var</span> year = date.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> month = date.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> img <span class="keyword">of</span> item[<span class="string">&quot;images&quot;</span>]) &#123;</span><br><span class="line">      <span class="keyword">var</span> thumbnail = imageBed + <span class="string">&#x27;/&#x27;</span> + galleryName + <span class="string">&quot;/thumbnail/&quot;</span> + img.<span class="property">name</span>;</span><br><span class="line">      <span class="keyword">var</span> artwork = imageBed + <span class="string">&#x27;/&#x27;</span> + galleryName + <span class="string">&quot;/artwork/&quot;</span> + img.<span class="property">name</span>;</span><br><span class="line">      <span class="keyword">var</span> caption = img.<span class="property">caption</span>;</span><br><span class="line">      <span class="keyword">var</span> address = img.<span class="property">address</span></span><br><span class="line">      <span class="keyword">var</span> width = img.<span class="property">width</span>;</span><br><span class="line">      <span class="keyword">var</span> height = img.<span class="property">height</span>;</span><br><span class="line"></span><br><span class="line">      liTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;figure class=&quot;thumb&quot; itemprop=&quot;associatedMedia&quot; itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageObject&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;<span class="subst">$&#123;artwork&#125;</span>&quot; itemprop=&quot;contentUrl&quot; data-size=&quot;<span class="subst">$&#123;width&#125;</span>x<span class="subst">$&#123;height&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;img class=&quot;reward-img&quot; data-src=&quot;<span class="subst">$&#123;thumbnail&#125;</span>&quot; src=&quot;/lib/album/assets/empty.png&quot; itemprop=&quot;thumbnail&quot; onload=&quot;lzld(this)&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;figcaption style=&quot;display:none;&quot; itemprop=&quot;caption description&quot;&gt;<span class="subst">$&#123;address || caption&#125;</span>&lt;/figcaption&gt;</span></span><br><span class="line"><span class="string">      &lt;/figure&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ulTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;section class=&quot;archives album&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 class=&quot;timeline&quot;&gt;<span class="subst">$&#123;year&#125;</span> å¹´ <span class="subst">$&#123;month&#125;</span> æœˆ&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;img-box&quot;&gt;<span class="subst">$&#123;liTmpl&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/section&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.instagram&#x27;</span>).<span class="property">innerHTML</span> = <span class="string">`&lt;div class=<span class="subst">$&#123;photoswipe.galleryClass&#125;</span> itemscope=&quot;&quot; itemtype=&quot;http://schema.org/ImageGallery&quot;&gt;<span class="subst">$&#123;ulTmpl&#125;</span>&lt;/div&gt;`</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#gallery-description&#x27;</span>).<span class="property">innerHTML</span> = description;</span><br><span class="line"></span><br><span class="line">  view.<span class="property">default</span>.<span class="title function_">init</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadData</span>(<span class="params">render</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!dataJSON) &#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, dataUrl, <span class="literal">true</span>);</span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">status</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        dataJSON = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span><br><span class="line">        <span class="title function_">render</span>(dataJSON);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">statusText</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="variable language_">this</span>.<span class="property">statusText</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.<span class="title function_">send</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(dataJSON);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Gallery</span> = &#123;</span><br><span class="line">  <span class="attr">init</span>: <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">loadData</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="title function_">render</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Gallery</span>.<span class="title function_">init</span>();</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ulTmpl += <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;section class=&quot;archives album&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;h3 class=&quot;timeline&quot;&gt;<span class="subst">$&#123;year&#125;</span> å¹´ <span class="subst">$&#123;month&#125;</span> æœˆ&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;img-box&quot;&gt;<span class="subst">$&#123;liTmpl&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/section&gt;`</span>;</span><br></pre></td></tr></table></figure>
<p>ä» <code>&lt;section class=&quot;archives album&quot;&gt;</code> åˆ° <code>$&#123;liTmpl&#125;</code>ï¼Œä¸­é—´åªèƒ½åµŒå¥—ä¸€å±‚ï¼›è‹¥æƒ³è¦åµŒå¥—å¤šå±‚ï¼Œè¦ä¿®æ”¹ <code>handler_photoswipe.js</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> parseThumbnailElements = <span class="keyword">function</span> <span class="title function_">parseThumbnailElements</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸¤æ¬¡è·å–çˆ¶èŠ‚ç‚¹ï¼Œé™å®šäº†æœ€å¤šåªèƒ½åµŒå¥—ä¸€å±‚ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¶…è¿‡ä¸€å±‚ï¼ˆå¤šå±‚æƒ…å†µä¹Ÿä¸€è‡´ï¼‰ï¼Œä¼šå› ä¸ºç¥–çˆ¶èŠ‚ç‚¹å®šä½åœ¨å•ä¸ªç…§ç‰‡ç»„ä¹‹å†…ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½¿å¾— photoswipe å°†ç…§ç‰‡ç»„ç”šè‡³å•ä¸ªç…§ç‰‡è§†ä¸ºä¸€ä¸ªç›¸å†Œï¼Œ</span></span><br><span class="line">    <span class="comment">// ä»è€Œé€ æˆç‚¹å‡»çš„ç…§ç‰‡åœ¨â€œç›¸å†Œâ€ä¸­çš„ç´¢å¼•ä¸å½“å‰ä¸å…¨å±€è·å–å›¾ç‰‡çš„ç´¢å¼•ä¸ä¸€è‡´</span></span><br><span class="line">    <span class="comment">// ç»“æœå°±æ˜¯ç‚¹å‡»å›¾ç‰‡ï¼Œæ”¾å¤§çš„æ˜¯å¦ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">    el = el.<span class="property">parentNode</span>.<span class="property">parentNode</span>;</span><br><span class="line">    <span class="keyword">var</span> thumbElements = el.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;thumb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¯¥é¡µé¢å…¨éƒ¨å›¾ç‰‡ `thumb` </span></span><br><span class="line">childNodes = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;thumb&#x27;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ”¾å¤§å›¾ç‰‡çš„è§„åˆ™ï¼šå½“å‰ç‚¹å‡»ç…§ç‰‡å…¨å±€ç´¢å¼• aï¼Œå½“å‰â€œç›¸å†Œâ€ ç…§ç‰‡æ•° xï¼Œæ”¾å¤§çš„å›¾ç‰‡åœ¨è¯¥â€œç›¸å†Œâ€å†…çš„ç´¢å¼•æ˜¯ aï¼›è‡ªç„¶ä¼šæœ‰ a &gt; x<br />
çš„æƒ…å†µï¼Œé‚£ç»“æœå°±æ˜¯å–â€œç›¸å†Œâ€çš„ç¬¬ä¸€å¼ ç…§ç‰‡ã€‚</p>
</blockquote>
<h3 id="5è‡ªåŠ¨åŒ–-json"><a class="markdownIt-Anchor" href="#5è‡ªåŠ¨åŒ–-json"></a> 5.è‡ªåŠ¨åŒ– JSON</h3>
<p>ä¸Šé¢è¯´åˆ°ç›¸å†Œçš„æ•°æ®æ˜¯ä» <code>data.json</code> è¯»å–çš„ï¼Œå¦‚æœç…§ç‰‡æˆ–è€…ç›¸å†Œæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆå†™ JSON ä¼šå¾ˆæ— èŠçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ Python æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p>
<blockquote>
<p>å› ä¸ºæˆ‘ä½¿ç”¨äº† Gitee çš„ä»“åº“æ¥ä½œä¸ºå›¾åºŠï¼Œæ‰€ä»¥ä¾¿ä¹ŸæŠŠ python è„šæœ¬ä¹Ÿå†™åœ¨äº†å›¾åºŠä»“åº“é‡Œã€‚</p>
</blockquote>
<p>è¿™ä¸€éƒ¨åˆ†å‚è€ƒ <a target="_blank" rel="noopener" href="https://houmin.cc/posts/d487dd02/">Hexo NexT æ·»åŠ å¤šçº§ç›¸å†ŒåŠŸèƒ½</a><br />
å°±å¯ä»¥äº†ï¼Œå®é™…ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œè¿›è¡Œéƒ¨åˆ†ä¿®æ”¹å’Œè°ƒæ•´ï¼Œæ¯”å¦‚æˆ‘å°±å¢åŠ äº†æ‰¹é‡æ·»åŠ å›¾ç‰‡ï¼Œè§£æ GPS<br />
è·å–åœ°å€ä»¥åŠæ‹æ‘„æ—¥æœŸï¼ˆä¸ªäººè§‰å¾—ä»å›¾ç‰‡åç§°è·å–æ—¥æœŸä¸ç¡®å®šæ€§æ¯”è¾ƒå¤§ï¼Œç”šè‡³å¯èƒ½å¾—ä¿®æ”¹å›¾ç‰‡åç§°ï¼‰ã€‚</p>
<blockquote>
<p>ä¸ºäº†è·å– Exif ä¿¡æ¯ï¼Œè‚¯å®šå¾—æ”¾ä¸ŠåŸå›¾ï¼Œä½†åŸå›¾å¦‚æœä¸Šä¼ åˆ°å›¾åº“ï¼Œä¹Ÿä¸åˆé€‚ï¼ˆğŸ˜é‚£ä½ è¿˜ä¸æ˜¯ä¸»åŠ¨æä¾›äº†åœ°å€ã€‚ã€‚ã€‚ğŸ˜‚ğŸ˜‚ğŸ˜‚<br />
ï¼‰ï¼Œæ‰€ä»¥æˆ‘å¤šå¢åŠ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾åŸå›¾ï¼Œä¸”ä¸ä¸Šä¼ çš„ã€‚</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset_orientation</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¤„ç†å›¾ç‰‡çš„è‡ªåŠ¨ï¼ˆPILå¤„ç†å›å‘ç”Ÿï¼‰æ—‹è½¬</span></span><br><span class="line"><span class="string">    å¢åŠ å¯¹ width / height çš„è°ƒæ¢å¤„ç†</span></span><br><span class="line"><span class="string">    https://cloud.tencent.com/developer/article/1523050</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    exif_orientation_tag = <span class="number">274</span></span><br><span class="line">    w, h = img.size</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(img, <span class="string">&quot;_getexif&quot;</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(img._getexif(), <span class="built_in">dict</span>) <span class="keyword">and</span> exif_orientation_tag <span class="keyword">in</span> img._getexif():</span><br><span class="line">        exif_data = img._getexif()</span><br><span class="line">        orientation = exif_data[exif_orientation_tag]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Handle EXIF Orientation</span></span><br><span class="line">        <span class="keyword">if</span> orientation == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># Normal image - nothing to do!</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># Mirrored left to right</span></span><br><span class="line">            <span class="comment"># transpose ç¿»è½¬</span></span><br><span class="line">            img = img.transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># Rotated 180 degrees</span></span><br><span class="line">            img = img.rotate(<span class="number">180</span>)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">4</span>:</span><br><span class="line">            <span class="comment"># Mirrored top to bottom</span></span><br><span class="line">            img = img.rotate(<span class="number">180</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">5</span>:</span><br><span class="line">            <span class="comment"># Mirrored along top-left diagonal</span></span><br><span class="line">            img = img.rotate(-<span class="number">90</span>, expand=<span class="literal">True</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">6</span>:</span><br><span class="line">            <span class="comment"># Rotated 90 degrees</span></span><br><span class="line">            img = img.rotate(-<span class="number">90</span>, expand=<span class="literal">True</span>)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">7</span>:</span><br><span class="line">            <span class="comment"># Mirrored along top-right diagonal</span></span><br><span class="line">            img = img.rotate(<span class="number">90</span>, expand=<span class="literal">True</span>).transpose(Image.FLIP_LEFT_RIGHT)</span><br><span class="line">            w, h = h, w</span><br><span class="line">        <span class="keyword">elif</span> orientation == <span class="number">8</span>:</span><br><span class="line">            <span class="comment"># Rotated 270 degrees</span></span><br><span class="line">            img = img.rotate(<span class="number">90</span>, expand=<span class="literal">True</span>)</span><br><span class="line">            w, h = h, w</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: img,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: (w, h)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_geocoder</span>(<span class="params">geolocator, lat_lon, sleep_sec=<span class="number">5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ ¹æ®ç»çº¬åº¦ï¼Œè®¡ç®—åŒºåŸŸ</span></span><br><span class="line"><span class="string">    https://www.pythonheidong.com/blog/article/680556/d9bf76d691415de282f1/</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åå‘åœ°ç†ç¼–ç </span></span><br><span class="line">        <span class="keyword">return</span> geolocator.reverse(lat_lon)</span><br><span class="line">    <span class="keyword">except</span> GeocoderTimedOut:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout: GeocoderTimedOut Retrying...&#x27;</span>)</span><br><span class="line">        time.sleep(randint(<span class="number">2</span> * <span class="number">100</span>, sleep_sec * <span class="number">100</span>) / <span class="number">50</span>)</span><br><span class="line">        <span class="keyword">return</span> AlbumTool.reverse_geocoder(geolocator, lat_lon, sleep_sec)</span><br><span class="line">    <span class="keyword">except</span> GeocoderServiceError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;CONNECTION REFUSED: GeocoderServiceError encountered.&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ERROR: Terminating due to exception &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_exif</span>(<span class="params">img</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–å›¾ç‰‡çš„ç»çº¬åº¦ä»¥åŠæ‹æ‘„æ—¶é—´ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="string">    https://zhuanlan.zhihu.com/p/98460548</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Loading and Resolving: &quot;</span> + img)</span><br><span class="line">    f = <span class="built_in">open</span>(img, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    image_map = exifread.process_file(f)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># å›¾ç‰‡çš„ç»åº¦</span></span><br><span class="line">        img_longitude_ref = image_map[<span class="string">&quot;GPS GPSLongitudeRef&quot;</span>].printable</span><br><span class="line">        img_longitude = image_map[<span class="string">&quot;GPS GPSLongitude&quot;</span>].printable[<span class="number">1</span>:-<span class="number">1</span>].replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;,&quot;</span>).split(</span><br><span class="line">            <span class="string">&quot;,&quot;</span>)</span><br><span class="line">        img_longitude = <span class="built_in">float</span>(img_longitude[<span class="number">0</span>]) + <span class="built_in">float</span>(img_longitude[<span class="number">1</span>]) / <span class="number">60</span> + <span class="built_in">float</span>(</span><br><span class="line">            img_longitude[<span class="number">2</span>]) / <span class="built_in">float</span>(img_longitude[<span class="number">3</span>]) / <span class="number">3600</span></span><br><span class="line">        <span class="keyword">if</span> img_longitude_ref != <span class="string">&quot;E&quot;</span>:</span><br><span class="line">            img_longitude = img_longitude * (-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å›¾ç‰‡çš„çº¬åº¦</span></span><br><span class="line">        img_latitude_ref = image_map[<span class="string">&quot;GPS GPSLatitudeRef&quot;</span>].printable</span><br><span class="line">        img_latitude = image_map[<span class="string">&quot;GPS GPSLatitude&quot;</span>].printable[<span class="number">1</span>:-<span class="number">1</span>].replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;,&quot;</span>).split(</span><br><span class="line">            <span class="string">&quot;,&quot;</span>)</span><br><span class="line">        img_latitude = <span class="built_in">float</span>(img_latitude[<span class="number">0</span>]) + <span class="built_in">float</span>(img_latitude[<span class="number">1</span>]) / <span class="number">60</span> + <span class="built_in">float</span>(img_latitude[<span class="number">2</span>]) / <span class="built_in">float</span>(</span><br><span class="line">            img_latitude[<span class="number">3</span>]) / <span class="number">3600</span></span><br><span class="line">        <span class="keyword">if</span> img_latitude_ref != <span class="string">&quot;N&quot;</span>:</span><br><span class="line">            img_latitude = img_latitude * (-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ERROR: å›¾ç‰‡ä¸­ä¸åŒ…å« Gps ä¿¡æ¯&#x27;</span>)</span><br><span class="line">        img_latitude = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        img_longitude = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç…§ç‰‡æ‹æ‘„æ—¶é—´</span></span><br><span class="line">    img_create_date = image_map[<span class="string">&quot;Image DateTime&quot;</span>].printable[:<span class="number">10</span>].replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;-&quot;</span>)</span><br><span class="line"></span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    location = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> img_latitude != <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> img_longitude != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        reverse_value = <span class="built_in">str</span>(img_latitude) + <span class="string">&#x27;, &#x27;</span> + <span class="built_in">str</span>(img_longitude)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ– Nominatim() æ—¶ä¼ å…¥æ–°çš„ user-agent å€¼ï¼Œé¿å¼€æ ·ä¾‹å€¼</span></span><br><span class="line">        user_agent = <span class="string">&#x27;my_blog_agent_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(randint(<span class="number">10000</span>, <span class="number">99999</span>))</span><br><span class="line">        geolocator = Nominatim(user_agent=user_agent)</span><br><span class="line">        location = AlbumTool.reverse_geocoder(geolocator, reverse_value)</span><br><span class="line"></span><br><span class="line">    address = location <span class="keyword">and</span> location.address <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    info = &#123;</span><br><span class="line">        <span class="string">&#x27;address&#x27;</span>: address,  <span class="comment"># åœ°å€</span></span><br><span class="line">        <span class="string">&#x27;date&#x27;</span>: img_create_date  <span class="comment"># æ—¥æœŸ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> info</span><br></pre></td></tr></table></figure>
<p>æ‰¹é‡æ·»åŠ å¾ˆç®€å•å°±ä¸è¯´äº†ã€‚ç›®å‰ä¸ºæ­¢ï¼Œç›¸å†Œéƒ¨åˆ†ç®—æ˜¯åŸºæœ¬å®Œå·¥äº†ã€‚æ•ˆæœè§ <a target="_blank" rel="noopener" href="https://richyu.gitee.io/album/">album</a>ã€‚</p>
<h5 id="è¡¥å……"><a class="markdownIt-Anchor" href="#è¡¥å……"></a> è¡¥å……</h5>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(self.data_json) <span class="keyword">as</span> json_file:</span><br><span class="line">    data = json.load(json_file)</span><br><span class="line">    items =  data[<span class="string">&quot;items&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>è¿™è¡Œä»£ç å¯èƒ½ä¼šäºŒæ¬¡è¯»å– JSON æ—¶ï¼Œé€ æˆä¹±ç ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æŒ‡å®šè¯»å–æ ¼å¼ï¼š</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(self.data_json, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> json_file</span><br></pre></td></tr></table></figure>
<h2 id="15themenext_configyml-minify-é…ç½®é—®é¢˜"><a class="markdownIt-Anchor" href="#15themenext_configyml-minify-é…ç½®é—®é¢˜"></a> 15.<code>theme/next/_config.yml minify é…ç½®é—®é¢˜</code></h2>
<p>ä»Šå¤©æ‰‹è´±ï¼Œä¿®æ”¹äº† <code>theme/next/_config.yml</code> çš„é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Allow to cache content generation.</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line"><span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove unnecessary files after hexo generate.</span></span><br><span class="line"><span class="comment">#minify: false</span></span><br><span class="line"><span class="attr">minify:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœæ¨é€æ—¶æŠ¥é”™äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NexT version 8.19.0</span><br><span class="line">Documentation: https://theme-next.js.org</span><br><span class="line">========================================</span><br><span class="line">INFO  Start processing</span><br><span class="line">FATAL Something&#x27;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.html</span><br><span class="line">TypeError: Cannot read properties of null (reading &#x27;style&#x27;)</span><br><span class="line">at Hexo.&lt;anonymous&gt; (C:\mywork\remote_project\hexo-source\themes\next\scripts\filters\minify.js:39:22)</span><br><span class="line">at Hexo.tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">at Hexo.&lt;anonymous&gt; (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\method.js:15:34)</span><br><span class="line">at C:\mywork\remote_project\hexo-source\node_modules\hexo\dist\extend\filter.js:58:67</span><br><span class="line">at tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">at Object.gotValue (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\reduce.js:166:18)</span><br><span class="line">at Object.gotAccum (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\reduce.js:155:25)</span><br><span class="line">at Object.tryCatcher (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">at Promise._settlePromiseFromHandler (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:547:31)</span><br><span class="line">at Promise._settlePromise (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:604:18)</span><br><span class="line">at Promise._settlePromiseCtx (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\promise.js:641:10)</span><br><span class="line">at _drainQueueStep (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\async.js:97:12)</span><br><span class="line">at _drainQueue (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\async.js:86:9)</span><br><span class="line">at Async._drainQueues (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\async.js:102:5)</span><br><span class="line">at Async.drainQueues [as _onImmediate] (C:\mywork\remote_project\hexo-source\node_modules\bluebird\js\release\async.js:15:14)</span><br><span class="line">at process.processImmediate (node:internal/timers:483:21)</span><br><span class="line">husky - pre-commit hook exited with code 2 (error)</span><br></pre></td></tr></table></figure>
<p>æ”¹å› <code>false</code> åå°±æ­£å¸¸äº†ã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>yum
  </li>
  <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://richardmyu.github.io/posts/fb53055d/" title="Hexo + Next - ä¸ªäººåšå®¢é…ç½®é—®é¢˜">https://richardmyu.github.io/posts/fb53055d/</a>
  </li>
  <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Hexo/" rel="tag"># Hexo</a>
              <a href="/tags/Next/" rel="tag"># Next</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/cc618d70/" rel="prev" title="ä¼ªç±» :focus">
                  <i class="fa fa-angle-left"></i> ä¼ªç±» :focus
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/f607b4cb/" rel="next" title="ã€ä¹¦ã€‘ç“¦å°”ç™»æ¹–">
                  ã€ä¹¦ã€‘ç“¦å°”ç™»æ¹– <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2018 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">yum</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

<script src="/js/highlight.min.js"></script>
<script>
  $(function(){
    $('pre code').each((i, el) => {
    hljs.highlightElement(el);
  });
</script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
